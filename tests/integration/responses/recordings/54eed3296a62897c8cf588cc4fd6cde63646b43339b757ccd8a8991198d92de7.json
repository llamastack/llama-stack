{
  "test_id": "tests/integration/responses/test_file_search.py::test_response_file_search_filter_by_region[openai_client-txt=ollama/llama3.2:3b-instruct-fp16]",
  "request": {
    "method": "POST",
    "url": "http://0.0.0.0:11434/v1/v1/chat/completions",
    "headers": {},
    "body": {
      "model": "llama3.2:3b-instruct-fp16",
      "messages": [
        {
          "role": "user",
          "content": "What are the updates from the US region?"
        },
        {
          "role": "assistant",
          "content": "",
          "tool_calls": [
            {
              "index": 0,
              "id": "call_6amxu035",
              "type": "function",
              "function": {
                "name": "knowledge_search",
                "arguments": "{\"query\":\"US region updates\"}"
              }
            }
          ]
        },
        {
          "role": "tool",
          "tool_call_id": "call_6amxu035",
          "content": [
            {
              "type": "text",
              "text": "knowledge_search tool found 2 chunks:\nBEGIN of knowledge_search tool results.\n"
            },
            {
              "type": "text",
              "text": "[1] document_id: file-885827357773, score: 0.005262354923099406, attributes: {'region': 'us', 'category': 'engineering', 'date': 1680307200.0, 'filename': 'us_engineering_q2.txt', 'file_id': 'file-885827357773', 'chunk_id': '084e15ad-480a-eae8-9242-391c53854867', 'document_id': 'file-885827357773', 'token_count': 18.0, 'metadata_token_count': 44.0} cite as <|file-885827357773|>\nUS technical updates for Q2 2023. New features deployed in the US region.\n"
            },
            {
              "type": "text",
              "text": "[2] document_id: file-885827357772, score: 0.0031691778880980773, attributes: {'region': 'us', 'category': 'marketing', 'date': 1672531200.0, 'filename': 'us_marketing_q1.txt', 'file_id': 'file-885827357772', 'chunk_id': 'a40d303b-40f6-42c8-a616-7a6276329426', 'document_id': 'file-885827357772', 'token_count': 21.0, 'metadata_token_count': 44.0} cite as <|file-885827357772|>\nUS promotional campaigns for Q1 2023. Revenue increased by 15% in the US region.\n"
            },
            {
              "type": "text",
              "text": "END of knowledge_search tool results.\n"
            },
            {
              "type": "text",
              "text": "The above results were retrieved to help answer the user's query: \"US region updates\". Use them as supporting information only in answering this query. Cite sources immediately at the end of sentences before punctuation, using `<|file-id|>` format like 'This is a fact <|file-Cn3MSNn72ENTiiq11Qda4A|>.'. Do not add extra punctuation. Use only the file IDs provided, do not invent new ones.\n"
            }
          ]
        }
      ],
      "parallel_tool_calls": true,
      "stream": true,
      "stream_options": {
        "include_usage": true
      },
      "tools": [
        {
          "type": "function",
          "function": {
            "name": "knowledge_search",
            "description": "Search for information in a database.",
            "parameters": {
              "type": "object",
              "properties": {
                "query": {
                  "type": "string",
                  "description": "The query to search for. Can be a natural language sentence or keywords."
                }
              },
              "required": [
                "query"
              ]
            }
          }
        }
      ]
    },
    "endpoint": "/v1/chat/completions",
    "model": "llama3.2:3b-instruct-fp16"
  },
  "response": {
    "body": [
      {
        "__type__": "openai.types.chat.chat_completion_chunk.ChatCompletionChunk",
        "__data__": {
          "id": "rec-54eed3296a62",
          "choices": [
            {
              "delta": {
                "content": "Unfortunately, I don't have specific information on recent updates from the US region available at this time. However, according to my knowledge search results, here are some updates that occurred in the US region:\n\nIn Q2 2023, new features were deployed in the US region (file: us_engineering_q2.txt).\n\nAdditionally, promotional campaigns in the US region increased revenue by 15% in Q1 2023 (file: us_marketing_q1.txt).",
                "function_call": null,
                "refusal": null,
                "role": "assistant",
                "tool_calls": null
              },
              "finish_reason": "stop",
              "index": 0,
              "logprobs": null
            }
          ],
          "created": 0,
          "model": "llama3.2:3b-instruct-fp16",
          "object": "chat.completion.chunk",
          "service_tier": null,
          "system_fingerprint": "fp_ollama",
          "usage": null
        }
      },
      {
        "__type__": "openai.types.chat.chat_completion_chunk.ChatCompletionChunk",
        "__data__": {
          "id": "rec-54eed3296a62",
          "choices": [],
          "created": 0,
          "model": "llama3.2:3b-instruct-fp16",
          "object": "chat.completion.chunk",
          "service_tier": null,
          "system_fingerprint": "fp_ollama",
          "usage": {
            "completion_tokens": 96,
            "prompt_tokens": 515,
            "total_tokens": 611,
            "completion_tokens_details": null,
            "prompt_tokens_details": null
          }
        }
      }
    ],
    "is_streaming": true
  },
  "id_normalization_mapping": {}
}
