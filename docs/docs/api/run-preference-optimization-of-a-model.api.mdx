---
id: run-preference-optimization-of-a-model
title: "Run preference optimization of a model."
description: "Run preference optimization of a model."
sidebar_label: "Run preference optimization of a model."
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/llama-stack-specification
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Run preference optimization of a model."}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/v1/post-training/preference-optimize"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Run preference optimization of a model.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[]}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string","description":"The UUID of the job to create."},"finetuned_model":{"type":"string","description":"The model to fine-tune."},"algorithm_config":{"description":"The algorithm configuration.","type":"object","properties":{"beta":{"type":"number","description":"Temperature parameter for the DPO loss"},"loss_type":{"default":"sigmoid","description":"The type of loss function to use for DPO","type":"string","enum":["sigmoid","hinge","ipo","kto_pair"],"title":"DPOLossType"}},"additionalProperties":false,"required":["beta","loss_type"],"title":"DPOAlignmentConfig"},"training_config":{"description":"The training configuration.","type":"object","properties":{"n_epochs":{"type":"integer","description":"Number of training epochs to run"},"max_steps_per_epoch":{"type":"integer","default":1,"description":"Maximum number of steps to run per epoch"},"gradient_accumulation_steps":{"type":"integer","default":1,"description":"Number of steps to accumulate gradients before updating"},"max_validation_steps":{"type":"integer","default":1,"description":"(Optional) Maximum number of validation steps per epoch"},"data_config":{"description":"(Optional) Configuration for data loading and formatting","type":"object","properties":{"dataset_id":{"type":"string","description":"Unique identifier for the training dataset"},"batch_size":{"type":"integer","description":"Number of samples per training batch"},"shuffle":{"type":"boolean","description":"Whether to shuffle the dataset during training"},"data_format":{"description":"Format of the dataset (instruct or dialog)","type":"string","enum":["instruct","dialog"],"title":"DatasetFormat"},"validation_dataset_id":{"type":"string","description":"(Optional) Unique identifier for the validation dataset"},"packed":{"type":"boolean","default":false,"description":"(Optional) Whether to pack multiple samples into a single sequence for efficiency"},"train_on_input":{"type":"boolean","default":false,"description":"(Optional) Whether to compute loss on input tokens as well as output tokens"}},"additionalProperties":false,"required":["dataset_id","batch_size","shuffle","data_format"],"title":"DataConfig"},"optimizer_config":{"description":"(Optional) Configuration for the optimization algorithm","type":"object","properties":{"optimizer_type":{"description":"Type of optimizer to use (adam, adamw, or sgd)","type":"string","enum":["adam","adamw","sgd"],"title":"OptimizerType"},"lr":{"type":"number","description":"Learning rate for the optimizer"},"weight_decay":{"type":"number","description":"Weight decay coefficient for regularization"},"num_warmup_steps":{"type":"integer","description":"Number of steps for learning rate warmup"}},"additionalProperties":false,"required":["optimizer_type","lr","weight_decay","num_warmup_steps"],"title":"OptimizerConfig"},"efficiency_config":{"description":"(Optional) Configuration for memory and compute optimizations","type":"object","properties":{"enable_activation_checkpointing":{"type":"boolean","default":false,"description":"(Optional) Whether to use activation checkpointing to reduce memory usage"},"enable_activation_offloading":{"type":"boolean","default":false,"description":"(Optional) Whether to offload activations to CPU to save GPU memory"},"memory_efficient_fsdp_wrap":{"type":"boolean","default":false,"description":"(Optional) Whether to use memory-efficient FSDP wrapping"},"fsdp_cpu_offload":{"type":"boolean","default":false,"description":"(Optional) Whether to offload FSDP parameters to CPU"}},"additionalProperties":false,"title":"EfficiencyConfig"},"dtype":{"type":"string","default":"bf16","description":"(Optional) Data type for model parameters (bf16, fp16, fp32)"}},"additionalProperties":false,"required":["n_epochs","max_steps_per_epoch","gradient_accumulation_steps"],"title":"TrainingConfig"},"hyperparam_search_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The hyperparam search configuration."},"logger_config":{"type":"object","additionalProperties":{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"},{"type":"array"},{"type":"object"}]},"description":"The logger configuration."}},"additionalProperties":false,"required":["job_uuid","finetuned_model","algorithm_config","training_config","hyperparam_search_config","logger_config"],"title":"PreferenceOptimizeRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"A PostTrainingJob.","content":{"application/json":{"schema":{"type":"object","properties":{"job_uuid":{"type":"string"}},"additionalProperties":false,"required":["job_uuid"],"title":"PostTrainingJob"}}}},"400":{"description":"The request was invalid or malformed","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":400,"title":"Bad Request","detail":"The request was invalid or malformed"}}}},"429":{"description":"The client has sent too many requests in a given amount of time","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":429,"title":"Too Many Requests","detail":"You have exceeded the rate limit. Please try again later."}}}},"500":{"description":"The server encountered an unexpected error","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":500,"title":"Internal Server Error","detail":"An unexpected error occurred. Our team has been notified."}}}},"default":{"description":"An unexpected error occurred","content":{"application/json":{"schema":{"type":"object","properties":{"status":{"type":"integer","description":"HTTP status code"},"title":{"type":"string","description":"Error title, a short summary of the error which is invariant for an error type"},"detail":{"type":"string","description":"Error detail, a longer human-readable description of the error"},"instance":{"type":"string","description":"(Optional) A URL which can be used to retrieve more information about the specific occurrence of the error"}},"additionalProperties":false,"required":["status","title","detail"],"title":"Error","description":"Error response from the API. Roughly follows RFC 7807."},"example":{"status":0,"title":"Error","detail":"An unexpected error occurred"}}}}}}
>
  
</StatusCodes>


      