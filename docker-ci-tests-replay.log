INFO     2026-02-17 17:08:32,310 llama_stack.cli.stack.run:147 cli: Using stack configuration:                          
         /workspace/src/llama_stack/distributions/ci-tests/config.yaml                                                  
INFO     2026-02-17 17:08:32,341 llama_stack.cli.stack.run:206 cli: HTTPS enabled with certificates:                    
           Key: None                                                                                                    
           Cert: None                                                                                                   
INFO     2026-02-17 17:08:32,342 llama_stack.cli.stack.run:208 cli: Listening on ['::', '0.0.0.0']:8321                 
INFO     2026-02-17 17:08:32,416 llama_stack.core.server.server:553 core::server: Stack Configuration:                  
INFO     2026-02-17 17:08:32,423 llama_stack.core.server.server:556 core::server: apis:                                 
         - agents                                                                                                       
         - batches                                                                                                      
         - datasetio                                                                                                    
         - eval                                                                                                         
         - file_processors                                                                                              
         - files                                                                                                        
         - inference                                                                                                    
         - post_training                                                                                                
         - safety                                                                                                       
         - scoring                                                                                                      
         - tool_runtime                                                                                                 
         - vector_io                                                                                                    
         connectors: []                                                                                                 
         distro_name: ci-tests                                                                                          
         providers:                                                                                                     
           agents:                                                                                                      
           - config:                                                                                                    
               persistence:                                                                                             
                 agent_state:                                                                                           
                   backend: kv_default                                                                                  
                   namespace: agents                                                                                    
                 responses:                                                                                             
                   backend: sql_default                                                                                 
                   max_write_queue_size: 10000                                                                          
                   num_writers: 4                                                                                       
                   table_name: responses                                                                                
             provider_id: meta-reference                                                                                
             provider_type: inline::meta-reference                                                                      
           batches:                                                                                                     
           - config:                                                                                                    
               kvstore:                                                                                                 
                 backend: kv_default                                                                                    
                 namespace: batches                                                                                     
             provider_id: reference                                                                                     
             provider_type: inline::reference                                                                           
           datasetio:                                                                                                   
           - config:                                                                                                    
               kvstore:                                                                                                 
                 backend: kv_default                                                                                    
                 namespace: datasetio::huggingface                                                                      
             provider_id: huggingface                                                                                   
             provider_type: remote::huggingface                                                                         
           - config:                                                                                                    
               kvstore:                                                                                                 
                 backend: kv_default                                                                                    
                 namespace: datasetio::localfs                                                                          
             provider_id: localfs                                                                                       
             provider_type: inline::localfs                                                                             
           eval:                                                                                                        
           - config:                                                                                                    
               kvstore:                                                                                                 
                 backend: kv_default                                                                                    
                 namespace: eval                                                                                        
             provider_id: meta-reference                                                                                
             provider_type: inline::meta-reference                                                                      
           file_processors:                                                                                             
           - config: {}                                                                                                 
             provider_id: pypdf                                                                                         
             provider_type: inline::pypdf                                                                               
           files:                                                                                                       
           - config:                                                                                                    
               metadata_store:                                                                                          
                 backend: sql_default                                                                                   
                 table_name: files_metadata                                                                             
               storage_dir: /root/.llama/distributions/ci-tests/files                                                   
             provider_id: meta-reference-files                                                                          
             provider_type: inline::localfs                                                                             
           inference:                                                                                                   
           - config:                                                                                                    
               api_key: '********'                                                                                      
               base_url: https://api.fireworks.ai/inference/v1                                                          
             provider_id: fireworks                                                                                     
             provider_type: remote::fireworks                                                                           
           - config:                                                                                                    
               api_key: '********'                                                                                      
               base_url: https://api.together.xyz/v1                                                                    
             provider_id: together                                                                                      
             provider_type: remote::together                                                                            
           - config:                                                                                                    
               api_key: '********'                                                                                      
               region_name: us-east-2                                                                                   
             provider_id: bedrock                                                                                       
             provider_type: remote::bedrock                                                                             
           - config:                                                                                                    
               api_key: '********'                                                                                      
               base_url: https://api.openai.com/v1                                                                      
             provider_id: openai                                                                                        
             provider_type: remote::openai                                                                              
           - config:                                                                                                    
               api_key: '********'                                                                                      
             provider_id: anthropic                                                                                     
             provider_type: remote::anthropic                                                                           
           - config:                                                                                                    
               api_key: '********'                                                                                      
             provider_id: gemini                                                                                        
             provider_type: remote::gemini                                                                              
           - config:                                                                                                    
               api_key: '********'                                                                                      
               base_url: https://api.groq.com/openai/v1                                                                 
             provider_id: groq                                                                                          
             provider_type: remote::groq                                                                                
           - config:                                                                                                    
               api_key: '********'                                                                                      
               base_url: https://api.sambanova.ai/v1                                                                    
             provider_id: sambanova                                                                                     
             provider_type: remote::sambanova                                                                           
           - config: {}                                                                                                 
             provider_id: sentence-transformers                                                                         
             provider_type: inline::sentence-transformers                                                               
           post_training:                                                                                               
           - config:                                                                                                    
               checkpoint_format: meta                                                                                  
             provider_id: torchtune-cpu                                                                                 
             provider_type: inline::torchtune-cpu                                                                       
           safety:                                                                                                      
           - config:                                                                                                    
               excluded_categories: []                                                                                  
             provider_id: llama-guard                                                                                   
             provider_type: inline::llama-guard                                                                         
           - config: {}                                                                                                 
             provider_id: code-scanner                                                                                  
             provider_type: inline::code-scanner                                                                        
           scoring:                                                                                                     
           - config: {}                                                                                                 
             provider_id: basic                                                                                         
             provider_type: inline::basic                                                                               
           - config: {}                                                                                                 
             provider_id: llm-as-judge                                                                                  
             provider_type: inline::llm-as-judge                                                                        
           - config:                                                                                                    
               openai_api_key: '********'                                                                               
             provider_id: braintrust                                                                                    
             provider_type: inline::braintrust                                                                          
           tool_runtime:                                                                                                
           - config:                                                                                                    
               api_key: '********'                                                                                      
               max_results: 3                                                                                           
             provider_id: brave-search                                                                                  
             provider_type: remote::brave-search                                                                        
           - config:                                                                                                    
               api_key: '********'                                                                                      
               max_results: 3                                                                                           
             provider_id: tavily-search                                                                                 
             provider_type: remote::tavily-search                                                                       
           - config: {}                                                                                                 
             provider_id: rag-runtime                                                                                   
             provider_type: inline::rag-runtime                                                                         
           - config: {}                                                                                                 
             provider_id: model-context-protocol                                                                        
             provider_type: remote::model-context-protocol                                                              
           vector_io:                                                                                                   
           - config:                                                                                                    
               persistence:                                                                                             
                 backend: kv_default                                                                                    
                 namespace: vector_io::faiss                                                                            
             provider_id: faiss                                                                                         
             provider_type: inline::faiss                                                                               
           - config:                                                                                                    
               db_path: /root/.llama/distributions/ci-tests/sqlite_vec.db                                               
               persistence:                                                                                             
                 backend: kv_default                                                                                    
                 namespace: vector_io::sqlite_vec                                                                       
             provider_id: sqlite-vec                                                                                    
             provider_type: inline::sqlite-vec                                                                          
         registered_resources:                                                                                          
           benchmarks: []                                                                                               
           datasets: []                                                                                                 
           models:                                                                                                      
           - metadata:                                                                                                  
               description: OpenAI GPT-OSS 20B on Bedrock (us-west-2)                                                   
             model_id: openai.gpt-oss-20b-1:0                                                                           
             model_type: llm                                                                                            
             provider_id: bedrock                                                                                       
             provider_model_id: openai.gpt-oss-20b-1:0                                                                  
           scoring_fns: []                                                                                              
           shields: []                                                                                                  
           tool_groups:                                                                                                 
           - provider_id: tavily-search                                                                                 
             toolgroup_id: builtin::websearch                                                                           
           - provider_id: rag-runtime                                                                                   
             toolgroup_id: builtin::rag                                                                                 
           vector_stores: []                                                                                            
         safety:                                                                                                        
           default_shield_id: llama-guard                                                                               
         server:                                                                                                        
           port: 8321                                                                                                   
           workers: 1                                                                                                   
         storage:                                                                                                       
           backends:                                                                                                    
             kv_default:                                                                                                
               db_path: /root/.llama/distributions/ci-tests/kvstore.db                                                  
               type: kv_sqlite                                                                                          
             sql_default:                                                                                               
               db_path: /root/.llama/distributions/ci-tests/sql_store.db                                                
               type: sql_sqlite                                                                                         
           stores:                                                                                                      
             connectors:                                                                                                
               backend: kv_default                                                                                      
               namespace: connectors                                                                                    
             conversations:                                                                                             
               backend: sql_default                                                                                     
               table_name: openai_conversations                                                                         
             inference:                                                                                                 
               backend: sql_default                                                                                     
               max_write_queue_size: 10000                                                                              
               num_writers: 4                                                                                           
               table_name: inference_store                                                                              
             metadata:                                                                                                  
               backend: kv_default                                                                                      
               namespace: registry                                                                                      
             prompts:                                                                                                   
               backend: kv_default                                                                                      
               namespace: prompts                                                                                       
         vector_stores:                                                                                                 
           annotation_prompt_params:                                                                                    
             annotation_instruction_template: Cite sources immediately at the end of sentences                          
               before punctuation, using `<|file-id|>` format like 'This is a fact <|file-Cn3MSNn72ENTiiq11Qda4A|>.'.   
               Do not add extra punctuation. Use only the file IDs provided, do not invent                              
               new ones.                                                                                                
             chunk_annotation_template: '[{index}] {metadata_text} cite as <|{file_id}|>                                
                                                                                                                        
               {chunk_text}                                                                                             
                                                                                                                        
               '                                                                                                        
             enable_annotations: true                                                                                   
           chunk_retrieval_params:                                                                                      
             chunk_multiplier: 5                                                                                        
             default_reranker_strategy: rrf                                                                             
             max_tokens_in_context: 4000                                                                                
             rrf_impact_factor: 60.0                                                                                    
             weighted_search_alpha: 0.5                                                                                 
           context_prompt_params:                                                                                       
             chunk_annotation_template: 'Result {index}                                                                 
                                                                                                                        
               Content: {chunk.content}                                                                                 
                                                                                                                        
               Metadata: {metadata}                                                                                     
                                                                                                                        
               '                                                                                                        
             context_template: 'The above results were retrieved to help answer the user''s                             
               query: "{query}". Use them as supporting information only in answering this                              
               query. {annotation_instruction}                                                                          
                                                                                                                        
               '                                                                                                        
           default_embedding_model:                                                                                     
             model_id: nomic-ai/nomic-embed-text-v1.5                                                                   
             provider_id: sentence-transformers                                                                         
           default_provider_id: faiss                                                                                   
           file_batch_params:                                                                                           
             cleanup_interval_seconds: 86400                                                                            
             file_batch_chunk_size: 10                                                                                  
             max_concurrent_files_per_batch: 3                                                                          
           file_ingestion_params:                                                                                       
             default_chunk_overlap_tokens: 128                                                                          
             default_chunk_size_tokens: 512                                                                             
           file_search_params:                                                                                          
             footer_template: 'END of knowledge_search tool results.                                                    
                                                                                                                        
               '                                                                                                        
             header_template: 'knowledge_search tool found {num_chunks} chunks:                                         
                                                                                                                        
               BEGIN of knowledge_search tool results.                                                                  
                                                                                                                        
               '                                                                                                        
         version: 2                                                                                                     
                                                                                                                        
INFO     2026-02-17 17:08:32,594 llama_stack.core.stack:611 core: API recording enabled: mode=replay                    
INFO     2026-02-17 17:08:36,457 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 139 models                                           
INFO     2026-02-17 17:08:40,928 uvicorn.error:92 server: Started server process [1]                                    
INFO     2026-02-17 17:08:40,929 uvicorn.error:48 server: Waiting for application startup.                              
INFO     2026-02-17 17:08:40,930 llama_stack.core.server.server:175 core::server: Starting up Llama Stack server        
         (version: 0.5.1.dev0)                                                                                          
INFO     2026-02-17 17:08:40,931 llama_stack.core.stack:712 core: starting registry refresh task                        
INFO     2026-02-17 17:08:40,932 uvicorn.error:62 server: Application startup complete.                                 
INFO     2026-02-17 17:08:40,932 uvicorn.error:224 server: Uvicorn running on http://['::', '0.0.0.0']:8321 (Press      
         CTRL+C to quit)                                                                                                
INFO     2026-02-17 17:08:41,104 uvicorn.access:480 server: ::1:42992 - "GET /v1/health HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,084 uvicorn.access:480 server: ::1:42998 - "GET /v1/providers HTTP/1.1" 200                
INFO     2026-02-17 17:08:43,096 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 139 models                                           
INFO     2026-02-17 17:08:43,098 uvicorn.access:480 server: ::1:42998 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,328 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,364 uvicorn.access:480 server: ::1:43014 - "GET                                            
         /v1/responses/resp_ba62e328-2d94-4b9b-9104-4bbc2d83e4c1 HTTP/1.1" 200                                          
INFO     2026-02-17 17:08:43,387 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,401 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,468 uvicorn.access:480 server: ::1:43014 - "GET                                            
         /v1/responses/resp_7b0842c4-a0a1-46b0-baa3-b599418cce08 HTTP/1.1" 200                                          
INFO     2026-02-17 17:08:43,473 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,513 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,534 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,569 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,598 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,620 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,633 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models                                           
INFO     2026-02-17 17:08:43,637 uvicorn.access:480 server: ::1:42998 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,651 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models                                           
INFO     2026-02-17 17:08:43,655 uvicorn.access:480 server: ::1:42998 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,663 uvicorn.access:480 server: ::1:42998 - "GET /v1/providers HTTP/1.1" 200                
INFO     2026-02-17 17:08:43,683 uvicorn.access:480 server: ::1:42998 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,737 uvicorn.access:480 server: ::1:42998 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,753 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models                                           
INFO     2026-02-17 17:08:43,759 uvicorn.access:480 server: ::1:42998 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,778 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models                                           
INFO     2026-02-17 17:08:43,783 uvicorn.access:480 server: ::1:42998 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,791 uvicorn.access:480 server: ::1:42998 - "GET /v1/providers HTTP/1.1" 200                
INFO     2026-02-17 17:08:43,797 uvicorn.access:480 server: ::1:42998 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,840 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models                                           
INFO     2026-02-17 17:08:43,846 uvicorn.access:480 server: ::1:42998 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,866 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models                                           
INFO     2026-02-17 17:08:43,870 uvicorn.access:480 server: ::1:42998 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,880 uvicorn.access:480 server: ::1:42998 - "GET /v1/providers HTTP/1.1" 200                
INFO     2026-02-17 17:08:43,926 uvicorn.access:480 server: ::1:42998 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,936 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 123 models                                           
INFO     2026-02-17 17:08:43,939 uvicorn.access:480 server: ::1:42998 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,953 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 123 models                                           
INFO     2026-02-17 17:08:43,955 uvicorn.access:480 server: ::1:42998 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:08:43,962 uvicorn.access:480 server: ::1:42998 - "GET /v1/providers HTTP/1.1" 200                
INFO     2026-02-17 17:08:43,978 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:08:43,981 uvicorn.access:480 server: ::1:42998 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:43,999 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:08:44,006 uvicorn.access:480 server: ::1:43014 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:08:44,146 uvicorn.access:480 server: ::1:43014 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:08:44,167 uvicorn.access:480 server: ::1:43014 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:08:44,188 uvicorn.access:480 server: ::1:43014 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:08:45,291 llama_stack.providers.utils.inference.embedding_mixin:93 providers::utils: Loading     
         sentence transformer for nomic-ai/nomic-embed-text-v1.5...                                                     
WARNING  2026-02-17 17:08:51,046 torchao.kernel.intmm:21 uncategorized: Warning: Detected no triton, on systems without 
         Triton certain kernels will not work                                                                           
/usr/local/lib/python3.12/site-packages/torchao/quantization/quant_api.py:1825: SyntaxWarning: invalid escape sequence '\.'
  * regex for parameter names, must start with `re:`, e.g. `re:language\.layers\..+\.q_proj.weight`.
Warning: You are sending unauthenticated requests to the HF Hub. Please set a HF_TOKEN to enable higher rate limits and faster downloads.
WARNING  2026-02-17 17:08:52,153 huggingface_hub.utils._http:779 uncategorized: Warning: You are sending unauthenticated
         requests to the HF Hub. Please set a HF_TOKEN to enable higher rate limits and faster downloads.               
A new version of the following files was downloaded from https://huggingface.co/nomic-ai/nomic-bert-2048:
- configuration_hf_nomic_bert.py
. Make sure to double-check they do not contain any added malicious code. To avoid downloading new versions of the code file, you can pin a revision.
A new version of the following files was downloaded from https://huggingface.co/nomic-ai/nomic-bert-2048:
- modeling_hf_nomic_bert.py
. Make sure to double-check they do not contain any added malicious code. To avoid downloading new versions of the code file, you can pin a revision.
WARNING  2026-02-17 17:09:09,411                                                                                        
         transformers_modules.nomic_hyphen_ai.nomic_hyphen_bert_hyphen_2048.7710840340a098cfb869c4f65e87cf2b1b70caca.mod
         eling_hf_nomic_bert:466 uncategorized: <All keys matched successfully>                                         
INFO     2026-02-17 17:09:10,834 uvicorn.access:480 server: ::1:43014 - "POST                                           
         /v1/vector_stores/vs_ab7a3ba7-84a5-4927-b4b2-d7679f88cd72/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:10,851 uvicorn.access:480 server: ::1:43014 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:10,862 uvicorn.access:480 server: ::1:43014 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:11,090 uvicorn.access:480 server: ::1:43014 - "POST                                           
         /v1/vector_stores/vs_ab7a3ba7-84a5-4927-b4b2-d7679f88cd72/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:11,105 uvicorn.access:480 server: ::1:43014 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:11,116 uvicorn.access:480 server: ::1:43014 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:11,361 uvicorn.access:480 server: ::1:43014 - "POST                                           
         /v1/vector_stores/vs_ab7a3ba7-84a5-4927-b4b2-d7679f88cd72/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:11,375 uvicorn.access:480 server: ::1:43014 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:11,386 uvicorn.access:480 server: ::1:43014 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:11,637 uvicorn.access:480 server: ::1:43014 - "POST                                           
         /v1/vector_stores/vs_ab7a3ba7-84a5-4927-b4b2-d7679f88cd72/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: b59dcd5f720e744ebd62d2a26005534c36b589b563b91c4dc611821cf726f66e
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:11,763 uvicorn.access:480 server: ::1:43014 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:11,766 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         b59dcd5f720e744ebd62d2a26005534c36b589b563b91c4dc611821cf726f66e                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:12,480 uvicorn.access:480 server: ::1:59132 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:12,616 uvicorn.access:480 server: ::1:59132 - "DELETE                                         
         /v1/vector_stores/vs_ab7a3ba7-84a5-4927-b4b2-d7679f88cd72 HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:12,747 uvicorn.access:480 server: ::1:59132 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:12,761 uvicorn.access:480 server: ::1:59132 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:12,779 uvicorn.access:480 server: ::1:59132 - "DELETE /v1/files/file-247992711530 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:12,790 uvicorn.access:480 server: ::1:59132 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:13,006 uvicorn.access:480 server: ::1:59132 - "POST                                           
         /v1/vector_stores/vs_b00b9f9b-6dce-4341-af20-2eb46eb6fa3b/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:13,020 uvicorn.access:480 server: ::1:59132 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:13,035 uvicorn.access:480 server: ::1:59132 - "DELETE /v1/files/file-247992711531 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:13,045 uvicorn.access:480 server: ::1:59132 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:13,262 uvicorn.access:480 server: ::1:59132 - "POST                                           
         /v1/vector_stores/vs_b00b9f9b-6dce-4341-af20-2eb46eb6fa3b/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:13,274 uvicorn.access:480 server: ::1:59132 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:13,288 uvicorn.access:480 server: ::1:59132 - "DELETE /v1/files/file-247992711532 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:13,299 uvicorn.access:480 server: ::1:59132 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:13,523 uvicorn.access:480 server: ::1:59132 - "POST                                           
         /v1/vector_stores/vs_b00b9f9b-6dce-4341-af20-2eb46eb6fa3b/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:13,536 uvicorn.access:480 server: ::1:59132 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:13,552 uvicorn.access:480 server: ::1:59132 - "DELETE /v1/files/file-247992711533 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:13,562 uvicorn.access:480 server: ::1:59132 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:13,795 uvicorn.access:480 server: ::1:59132 - "POST                                           
         /v1/vector_stores/vs_b00b9f9b-6dce-4341-af20-2eb46eb6fa3b/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 999a4332b01abe2f8130812be3c76ff108dc8aeede626b230d0930897d0bdcf7
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:13,917 uvicorn.access:480 server: ::1:59132 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:13,921 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         999a4332b01abe2f8130812be3c76ff108dc8aeede626b230d0930897d0bdcf7                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:14,340 uvicorn.access:480 server: ::1:59140 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:14,475 uvicorn.access:480 server: ::1:59140 - "DELETE                                         
         /v1/vector_stores/vs_b00b9f9b-6dce-4341-af20-2eb46eb6fa3b HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:14,603 uvicorn.access:480 server: ::1:59140 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:14,616 uvicorn.access:480 server: ::1:59140 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:14,630 uvicorn.access:480 server: ::1:59140 - "DELETE /v1/files/file-824569833174 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:14,641 uvicorn.access:480 server: ::1:59140 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:14,841 uvicorn.access:480 server: ::1:59140 - "POST                                           
         /v1/vector_stores/vs_56ed4379-240f-4d67-912e-8c12dc3d1e24/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:14,855 uvicorn.access:480 server: ::1:59140 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:14,870 uvicorn.access:480 server: ::1:59140 - "DELETE /v1/files/file-824569833175 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:14,880 uvicorn.access:480 server: ::1:59140 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:15,103 uvicorn.access:480 server: ::1:59140 - "POST                                           
         /v1/vector_stores/vs_56ed4379-240f-4d67-912e-8c12dc3d1e24/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:15,115 uvicorn.access:480 server: ::1:59140 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:15,128 uvicorn.access:480 server: ::1:59140 - "DELETE /v1/files/file-824569833176 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:15,138 uvicorn.access:480 server: ::1:59140 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:15,374 uvicorn.access:480 server: ::1:59140 - "POST                                           
         /v1/vector_stores/vs_56ed4379-240f-4d67-912e-8c12dc3d1e24/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:15,386 uvicorn.access:480 server: ::1:59140 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:15,400 uvicorn.access:480 server: ::1:59140 - "DELETE /v1/files/file-824569833177 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:15,411 uvicorn.access:480 server: ::1:59140 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:15,646 uvicorn.access:480 server: ::1:59140 - "POST                                           
         /v1/vector_stores/vs_56ed4379-240f-4d67-912e-8c12dc3d1e24/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 8e614f19b581d4d23ce3a19bdd08495987608085022ceb49654943076f24e089
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:15,784 uvicorn.access:480 server: ::1:59140 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:15,787 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         8e614f19b581d4d23ce3a19bdd08495987608085022ceb49654943076f24e089                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:16,175 uvicorn.access:480 server: ::1:37616 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:16,311 uvicorn.access:480 server: ::1:37616 - "DELETE                                         
         /v1/vector_stores/vs_56ed4379-240f-4d67-912e-8c12dc3d1e24 HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:16,447 uvicorn.access:480 server: ::1:37616 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:16,460 uvicorn.access:480 server: ::1:37616 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:16,474 uvicorn.access:480 server: ::1:37616 - "DELETE /v1/files/file-151637398235 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:16,484 uvicorn.access:480 server: ::1:37616 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:16,724 uvicorn.access:480 server: ::1:37616 - "POST                                           
         /v1/vector_stores/vs_b98d4621-6244-4573-a744-b884ef086539/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:16,738 uvicorn.access:480 server: ::1:37616 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:16,755 uvicorn.access:480 server: ::1:37616 - "DELETE /v1/files/file-151637398236 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:16,765 uvicorn.access:480 server: ::1:37616 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:16,983 uvicorn.access:480 server: ::1:37616 - "POST                                           
         /v1/vector_stores/vs_b98d4621-6244-4573-a744-b884ef086539/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:16,994 uvicorn.access:480 server: ::1:37616 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:17,007 uvicorn.access:480 server: ::1:37616 - "DELETE /v1/files/file-151637398237 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:17,018 uvicorn.access:480 server: ::1:37616 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:17,240 uvicorn.access:480 server: ::1:37616 - "POST                                           
         /v1/vector_stores/vs_b98d4621-6244-4573-a744-b884ef086539/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:17,254 uvicorn.access:480 server: ::1:37616 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:17,269 uvicorn.access:480 server: ::1:37616 - "DELETE /v1/files/file-151637398238 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:17,279 uvicorn.access:480 server: ::1:37616 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:17,548 uvicorn.access:480 server: ::1:37616 - "POST                                           
         /v1/vector_stores/vs_b98d4621-6244-4573-a744-b884ef086539/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: a9a4f936a162948523a5adf783f5d66f3c1c005aed9ffe51f871addb5e051ef2
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:17,688 uvicorn.access:480 server: ::1:37616 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:17,692 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         a9a4f936a162948523a5adf783f5d66f3c1c005aed9ffe51f871addb5e051ef2                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:18,122 uvicorn.access:480 server: ::1:37626 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:18,257 uvicorn.access:480 server: ::1:37626 - "DELETE                                         
         /v1/vector_stores/vs_b98d4621-6244-4573-a744-b884ef086539 HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:18,387 uvicorn.access:480 server: ::1:37626 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:18,401 uvicorn.access:480 server: ::1:37626 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:18,413 uvicorn.access:480 server: ::1:37626 - "DELETE /v1/files/file-90357487491 HTTP/1.1" 200
INFO     2026-02-17 17:09:18,423 uvicorn.access:480 server: ::1:37626 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:18,663 uvicorn.access:480 server: ::1:37626 - "POST                                           
         /v1/vector_stores/vs_487b99b4-f579-4ef7-8cb7-cfbcb146af43/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:18,677 uvicorn.access:480 server: ::1:37626 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:18,692 uvicorn.access:480 server: ::1:37626 - "DELETE /v1/files/file-90357487492 HTTP/1.1" 200
INFO     2026-02-17 17:09:18,702 uvicorn.access:480 server: ::1:37626 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:18,978 uvicorn.access:480 server: ::1:37626 - "POST                                           
         /v1/vector_stores/vs_487b99b4-f579-4ef7-8cb7-cfbcb146af43/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:18,990 uvicorn.access:480 server: ::1:37626 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:19,004 uvicorn.access:480 server: ::1:37626 - "DELETE /v1/files/file-90357487493 HTTP/1.1" 200
INFO     2026-02-17 17:09:19,014 uvicorn.access:480 server: ::1:37626 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:19,251 uvicorn.access:480 server: ::1:37626 - "POST                                           
         /v1/vector_stores/vs_487b99b4-f579-4ef7-8cb7-cfbcb146af43/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:19,265 uvicorn.access:480 server: ::1:37626 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:19,280 uvicorn.access:480 server: ::1:37626 - "DELETE /v1/files/file-90357487494 HTTP/1.1" 200
INFO     2026-02-17 17:09:19,290 uvicorn.access:480 server: ::1:37626 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:19,527 uvicorn.access:480 server: ::1:37626 - "POST                                           
         /v1/vector_stores/vs_487b99b4-f579-4ef7-8cb7-cfbcb146af43/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 0e65da5e09ce2196375b03a0269e165d156cec74cfbd1ecf1409b1a0465a0164
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:19,660 uvicorn.access:480 server: ::1:37626 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:19,663 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         0e65da5e09ce2196375b03a0269e165d156cec74cfbd1ecf1409b1a0465a0164                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:20,072 uvicorn.access:480 server: ::1:37632 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:20,205 uvicorn.access:480 server: ::1:37632 - "DELETE                                         
         /v1/vector_stores/vs_487b99b4-f579-4ef7-8cb7-cfbcb146af43 HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:20,336 uvicorn.access:480 server: ::1:37632 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:20,348 uvicorn.access:480 server: ::1:37632 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:20,362 uvicorn.access:480 server: ::1:37632 - "DELETE /v1/files/file-862946202234 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:20,372 uvicorn.access:480 server: ::1:37632 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:20,580 uvicorn.access:480 server: ::1:37632 - "POST                                           
         /v1/vector_stores/vs_c4e856c4-84d9-4c53-84cb-eb69d2671d59/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:20,593 uvicorn.access:480 server: ::1:37632 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:20,609 uvicorn.access:480 server: ::1:37632 - "DELETE /v1/files/file-862946202235 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:20,620 uvicorn.access:480 server: ::1:37632 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:20,834 uvicorn.access:480 server: ::1:37632 - "POST                                           
         /v1/vector_stores/vs_c4e856c4-84d9-4c53-84cb-eb69d2671d59/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:20,846 uvicorn.access:480 server: ::1:37632 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:20,860 uvicorn.access:480 server: ::1:37632 - "DELETE /v1/files/file-862946202236 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:20,870 uvicorn.access:480 server: ::1:37632 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:21,090 uvicorn.access:480 server: ::1:37632 - "POST                                           
         /v1/vector_stores/vs_c4e856c4-84d9-4c53-84cb-eb69d2671d59/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:21,103 uvicorn.access:480 server: ::1:37632 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:21,119 uvicorn.access:480 server: ::1:37632 - "DELETE /v1/files/file-862946202237 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:21,129 uvicorn.access:480 server: ::1:37632 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:21,355 uvicorn.access:480 server: ::1:37632 - "POST                                           
         /v1/vector_stores/vs_c4e856c4-84d9-4c53-84cb-eb69d2671d59/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:21,363 uvicorn.access:480 server: ::1:37632 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:21,626 uvicorn.access:480 server: ::1:37632 - "DELETE                                         
         /v1/vector_stores/vs_c4e856c4-84d9-4c53-84cb-eb69d2671d59 HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:21,642 uvicorn.access:480 server: ::1:37632 - "DELETE /v1/files/file-284290576316 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:21,655 uvicorn.access:480 server: ::1:37632 - "DELETE /v1/files/file-284290576317 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:21,667 uvicorn.access:480 server: ::1:37632 - "DELETE /v1/files/file-284290576318 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:21,679 uvicorn.access:480 server: ::1:37632 - "DELETE /v1/files/file-284290576319 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:21,689 uvicorn.access:480 server: ::1:37632 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:21,820 uvicorn.access:480 server: ::1:37632 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:21,830 uvicorn.access:480 server: ::1:37632 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:21,841 uvicorn.access:480 server: ::1:37632 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:22,024 uvicorn.access:480 server: ::1:37632 - "POST                                           
         /v1/vector_stores/vs_d133d3ed-0b4e-49d3-9ee6-ef531de79982/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:22,034 uvicorn.access:480 server: ::1:37632 - "GET                                            
         /v1/vector_stores/vs_d133d3ed-0b4e-49d3-9ee6-ef531de79982/files/file-861837565219 HTTP/1.1" 200                
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 587472633c01f98186e7446d7177fba87c38fe49f54f5aa7674ee24925c234cc
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:22,134 uvicorn.access:480 server: ::1:37632 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:22,135 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         587472633c01f98186e7446d7177fba87c38fe49f54f5aa7674ee24925c234cc                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:22,673 uvicorn.access:480 server: ::1:37646 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:22,798 uvicorn.access:480 server: ::1:37646 - "DELETE                                         
         /v1/vector_stores/vs_d133d3ed-0b4e-49d3-9ee6-ef531de79982 HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:22,929 uvicorn.access:480 server: ::1:37646 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:22,943 uvicorn.access:480 server: ::1:37646 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:22,954 uvicorn.access:480 server: ::1:37646 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:23,191 uvicorn.access:480 server: ::1:37646 - "POST                                           
         /v1/vector_stores/vs_212e0e4e-7c5d-41a7-a233-fb7b6daab181/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:23,200 uvicorn.access:480 server: ::1:37646 - "GET                                            
         /v1/vector_stores/vs_212e0e4e-7c5d-41a7-a233-fb7b6daab181/files/file-528246887823 HTTP/1.1" 200                
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 7fc49323f48034a5ada9cba478615915c76783423922c0c0ba6738ab719b26ab
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:23,286 uvicorn.access:480 server: ::1:37646 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:23,287 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         7fc49323f48034a5ada9cba478615915c76783423922c0c0ba6738ab719b26ab                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:24,525 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 400               
INFO     2026-02-17 17:09:25,314 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:25,859 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 121 models                                           
INFO     2026-02-17 17:09:25,868 uvicorn.access:480 server: ::1:35996 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:09:25,911 llama_stack.providers.utils.inference.openai_mixin:516 providers::utils:               
         OpenAIInferenceAdapter.list_provider_model_ids() returned 121 models                                           
INFO     2026-02-17 17:09:25,918 uvicorn.access:480 server: ::1:35996 - "GET /v1/models HTTP/1.1" 200                   
INFO     2026-02-17 17:09:25,936 uvicorn.access:480 server: ::1:35996 - "GET /v1/providers HTTP/1.1" 200                
INFO     2026-02-17 17:09:26,010 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:26,256 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
ERROR    2026-02-17 17:09:26,931 llama_stack.providers.inline.agents.meta_reference.responses.streaming:1375            
         agents::meta_reference: Failed to list MCP tools from http://localhost:54685/sse: Client error '401            
         Unauthorized' for url 'http://localhost:54685/sse'                                                             
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401                       
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/mcp/client/sse.py:74 in sse_client                                  │
         │                                                                                                             │
         │    71 │   │   │   │   │   "GET",                                                                            │
         │    72 │   │   │   │   │   url,                                                                              │
         │    73 │   │   │   │   ) as event_source:                                                                    │
         │ ❱  74 │   │   │   │   │   event_source.response.raise_for_status()                                          │
         │    75 │   │   │   │   │   logger.debug("SSE connection established")                                        │
         │    76 │   │   │   │   │                                                                                     │
         │    77 │   │   │   │   │   async def sse_reader(                                                             │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/httpx/_models.py:829 in raise_for_status                            │
         │                                                                                                             │
         │    826 │   │   }                                                                                            │
         │    827 │   │   error_type = error_types.get(status_class, "Invalid status code")                            │
         │    828 │   │   message = message.format(self, error_type=error_type)                                        │
         │ ❱  829 │   │   raise HTTPStatusError(message, request=request, response=self)                               │
         │    830 │                                                                                                    │
         │    831 │   def json(self, **kwargs: typing.Any) -> typing.Any:                                              │
         │    832 │   │   return jsonlib.loads(self.content, **kwargs)                                                 │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         HTTPStatusError: Client error '401 Unauthorized' for url 'http://localhost:54685/sse'                          
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401                       
                                                                                                                        
         The above exception was the direct cause of the following exception:                                           
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py:1322 in            │
         │ _process_mcp_tool                                                                                           │
         │                                                                                                             │
         │   1319 │   │   │   # TODO: follow semantic conventions for Open Telemetry tool spans                        │
         │   1320 │   │   │   #                                                                                        │
         │        https://opentelemetry.io/docs/specs/semconv/gen-ai/gen-ai-spans/#execute-tool-span                   │
         │   1321 │   │   │   with tracer.start_as_current_span("list_mcp_tools", attributes=attributes):              │
         │ ❱ 1322 │   │   │   │   tool_defs = await list_mcp_tools(                                                    │
         │   1323 │   │   │   │   │   endpoint=mcp_tool.server_url,                                                    │
         │   1324 │   │   │   │   │   headers=mcp_tool.headers,                                                        │
         │   1325 │   │   │   │   │   authorization=mcp_tool.authorization,                                            │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:404 in list_mcp_tools                               │
         │                                                                                                             │
         │   401 │                                                                                                     │
         │   402 │   # If a session manager is provided, use it for session reuse (fix for #4452)                      │
         │   403 │   if session_manager is not None:                                                                   │
         │ ❱ 404 │   │   session = await session_manager.get_session(endpoint, final_headers)                          │
         │   405 │   │   await _list_tools_from_session(session)                                                       │
         │   406 │   else:                                                                                             │
         │   407 │   │   # Fallback to original behavior: create a new session for this call                           │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:144 in get_session                                  │
         │                                                                                                             │
         │   141 │   │   │   │   return session                                                                        │
         │   142 │   │   │                                                                                             │
         │   143 │   │   │   # Create new session                                                                      │
         │ ❱ 144 │   │   │   session, client_ctx, session_ctx = await self._create_session(endpoint,                   │
         │       headers)                                                                                              │
         │   145 │   │   │   self._sessions[key] = (session, client_ctx, session_ctx)                                  │
         │   146 │   │   │   logger.debug(f"Created new MCP session for {endpoint} (key: {key[:32]}...)")              │
         │   147 │   │   │   return session                                                                            │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:194 in _create_session                              │
         │                                                                                                             │
         │   191 │   │   │   │   for exc in eg.exceptions:                                                             │
         │   192 │   │   │   │   │   err = cast(httpx.HTTPStatusError, exc)                                            │
         │   193 │   │   │   │   │   if err.response.status_code == 401:                                               │
         │ ❱ 194 │   │   │   │   │   │   raise AuthenticationRequiredError(exc) from exc                               │
         │   195 │   │   │   │   if i == len(connection_strategies) - 1:                                               │
         │   196 │   │   │   │   │   raise                                                                             │
         │   197 │   │   │   │   last_exception = eg                                                                   │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         AuthenticationRequiredError: Client error '401 Unauthorized' for url 'http://localhost:54685/sse'              
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401                       
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/mcp/client/sse.py", line 74, in sse_client
    event_source.response.raise_for_status()
  File "/usr/local/lib/python3.12/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'http://localhost:54685/sse'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 550, in create_openai_response
    async for stream_chunk in stream_gen:
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 681, in _create_streaming_response
    async for stream_chunk in orchestrator.create_response():
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 318, in create_response
    async for stream_event in self._process_tools(output_messages):
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1389, in _process_tools
    async for stream_event in self._process_new_tools(
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1279, in _process_new_tools
    async for stream_event in self._process_mcp_tool(input_tool, output_messages):
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1322, in _process_mcp_tool
    tool_defs = await list_mcp_tools(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 404, in list_mcp_tools
    session = await session_manager.get_session(endpoint, final_headers)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 144, in get_session
    session, client_ctx, session_ctx = await self._create_session(endpoint, headers)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 194, in _create_session
    raise AuthenticationRequiredError(exc) from exc
llama_stack.core.datatypes.AuthenticationRequiredError: Client error '401 Unauthorized' for url 'http://localhost:54685/sse'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
INFO     2026-02-17 17:09:27,106 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 401               
INFO     2026-02-17 17:09:27,155 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:27,891 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:27,915 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:28,634 llama_stack.providers.inline.agents.meta_reference.responses.streaming:581             
         agents::meta_reference: Requesting approval for call_988PBvyfdY38pwgrNl5Ibm7Y on get_boiling_point             
INFO     2026-02-17 17:09:28,646 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:28,668 llama_stack.providers.inline.agents.meta_reference.responses.streaming:575             
         agents::meta_reference: Approval granted for call_988PBvyfdY38pwgrNl5Ibm7Y on get_boiling_point                
INFO     2026-02-17 17:09:28,697 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:29,238 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:09:29,250 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:29,301 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:09:29,306 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:29,334 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:29,358 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:09:29,362 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:29,382 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:29,634 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:30,269 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:30,962 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:09:30,973 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 466, in app
    raise validation_error
fastapi.exceptions.RequestValidationError: 1 validation error:
  {'type': 'greater_than_equal', 'loc': ('body', 'max_tool_calls'), 'msg': 'Input should be greater than or equal to 1', 'input': 0, 'ctx': {'ge': 1}}

  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 219, in create_openai_response
    POST /v1/responses
INFO     2026-02-17 17:09:30,979 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 400               
INFO     2026-02-17 17:09:31,390 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:31,537 llama_stack.providers.inline.agents.meta_reference.responses.streaming:1122            
         agents::meta_reference: Ignoring built-in and mcp tool call since reached the limit of self.max_tool_calls=1.  
INFO     2026-02-17 17:09:31,554 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:31,720 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:32,275 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:09:32,281 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:32,338 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:09:32,346 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:32,610 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:32,821 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:33,340 uvicorn.access:480 server: ::1:37660 - "POST /v1/conversations HTTP/1.1" 200           
INFO     2026-02-17 17:09:33,567 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:33,784 uvicorn.access:480 server: ::1:37660 - "GET                                            
         /v1/conversations/conv_06214936d7989cbedb70284d9d1203e41331d9c08ddd9583/items HTTP/1.1" 200                    
INFO     2026-02-17 17:09:33,803 uvicorn.access:480 server: ::1:37660 - "POST /v1/conversations HTTP/1.1" 200           
INFO     2026-02-17 17:09:34,019 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:34,022 uvicorn.access:480 server: ::1:37660 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:34,842 uvicorn.access:480 server: ::1:36004 - "GET                                            
         /v1/conversations/conv_d3a9effe1a4ca2366bcd21c3020324d53e3e46fe3edbc03b/items HTTP/1.1" 200                    
INFO     2026-02-17 17:09:34,861 uvicorn.access:480 server: ::1:36004 - "POST /v1/conversations HTTP/1.1" 200           
INFO     2026-02-17 17:09:34,956 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:34,963 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 400               
INFO     2026-02-17 17:09:34,970 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 400               
INFO     2026-02-17 17:09:35,006 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,076 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,125 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 200               
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 466, in app
    raise validation_error
fastapi.exceptions.RequestValidationError: 1 validation error:
  {'type': 'greater_than_equal', 'loc': ('body', 'max_output_tokens'), 'msg': 'Input should be greater than or equal to 16', 'input': 15, 'ctx': {'ge': 16}}

  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 219, in create_openai_response
    POST /v1/responses
INFO     2026-02-17 17:09:35,131 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 400               
INFO     2026-02-17 17:09:35,154 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,160 uvicorn.access:480 server: ::1:36004 - "GET                                            
         /v1/responses/resp_e1e7f59f-2149-436c-b734-9dfd2749474a HTTP/1.1" 200                                          
INFO     2026-02-17 17:09:35,238 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,244 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,279 uvicorn.access:480 server: ::1:36004 - "GET                                            
         /v1/responses/resp_f1dea148-9c3e-40c9-ab8d-bdf196f3a3a1 HTTP/1.1" 200                                          
INFO     2026-02-17 17:09:35,284 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,331 uvicorn.access:480 server: ::1:36018 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,423 uvicorn.access:480 server: ::1:36018 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,457 uvicorn.access:480 server: ::1:36018 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,488 uvicorn.access:480 server: ::1:36018 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,536 uvicorn.access:480 server: ::1:36018 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,611 uvicorn.access:480 server: ::1:36004 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:09:35,617 uvicorn.access:480 server: ::1:36018 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:35,750 uvicorn.access:480 server: ::1:36018 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:35,761 uvicorn.access:480 server: ::1:36018 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:35,771 uvicorn.access:480 server: ::1:36018 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:36,660 uvicorn.access:480 server: ::1:36018 - "POST                                           
         /v1/vector_stores/vs_27be157c-77af-4955-9e3c-02b26d39a8e7/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:36,667 uvicorn.access:480 server: ::1:36018 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:36,676 uvicorn.access:480 server: ::1:36018 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:37,211 uvicorn.access:480 server: ::1:36018 - "POST                                           
         /v1/vector_stores/vs_27be157c-77af-4955-9e3c-02b26d39a8e7/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:37,256 uvicorn.access:480 server: ::1:36018 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:37,377 uvicorn.access:480 server: ::1:36018 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:37,719 uvicorn.access:480 server: ::1:36018 - "POST                                           
         /v1/vector_stores/vs_27be157c-77af-4955-9e3c-02b26d39a8e7/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:37,833 uvicorn.access:480 server: ::1:36018 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:37,853 uvicorn.access:480 server: ::1:36018 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:39,017 uvicorn.access:480 server: ::1:36018 - "POST                                           
         /v1/vector_stores/vs_27be157c-77af-4955-9e3c-02b26d39a8e7/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 04b0c60ca442f6598bd48d12d20db2ec7a6b65c27e7eeb17d04ecc4f3d0c95d1
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:39,331 uvicorn.access:480 server: ::1:36018 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:39,332 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         04b0c60ca442f6598bd48d12d20db2ec7a6b65c27e7eeb17d04ecc4f3d0c95d1                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:40,435 uvicorn.access:480 server: ::1:50552 - "DELETE                                         
         /v1/vector_stores/vs_27be157c-77af-4955-9e3c-02b26d39a8e7 HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:40,537 uvicorn.access:480 server: ::1:50552 - "DELETE /v1/files/file-446066738449 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:40,646 uvicorn.access:480 server: ::1:50552 - "DELETE /v1/files/file-446066738450 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:40,653 uvicorn.access:480 server: ::1:50552 - "DELETE /v1/files/file-446066738451 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:40,662 uvicorn.access:480 server: ::1:50552 - "DELETE /v1/files/file-446066738452 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:40,665 uvicorn.access:480 server: ::1:50552 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:40,843 uvicorn.access:480 server: ::1:50552 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:40,855 uvicorn.access:480 server: ::1:50552 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:40,863 uvicorn.access:480 server: ::1:50552 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:41,341 uvicorn.access:480 server: ::1:50552 - "POST                                           
         /v1/vector_stores/vs_f3eab5a1-fe09-4f12-97ed-b8a38fe3e236/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:41,346 uvicorn.access:480 server: ::1:50552 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:41,473 uvicorn.access:480 server: ::1:50552 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:42,263 uvicorn.access:480 server: ::1:50552 - "POST                                           
         /v1/vector_stores/vs_f3eab5a1-fe09-4f12-97ed-b8a38fe3e236/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:42,296 uvicorn.access:480 server: ::1:50552 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:42,333 uvicorn.access:480 server: ::1:50552 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:44,049 uvicorn.access:480 server: ::1:50552 - "POST                                           
         /v1/vector_stores/vs_f3eab5a1-fe09-4f12-97ed-b8a38fe3e236/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:44,073 uvicorn.access:480 server: ::1:50552 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:44,115 uvicorn.access:480 server: ::1:50552 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:44,899 uvicorn.access:480 server: ::1:50552 - "POST                                           
         /v1/vector_stores/vs_f3eab5a1-fe09-4f12-97ed-b8a38fe3e236/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: a7d5c38c55b222aa63fd7b2df2978ba925d6401719bfd2a424a8831d4dc1e10d
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:45,989 uvicorn.access:480 server: ::1:50552 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:45,991 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         a7d5c38c55b222aa63fd7b2df2978ba925d6401719bfd2a424a8831d4dc1e10d                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:46,955 uvicorn.access:480 server: ::1:57282 - "DELETE                                         
         /v1/vector_stores/vs_f3eab5a1-fe09-4f12-97ed-b8a38fe3e236 HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:47,424 uvicorn.access:480 server: ::1:57282 - "DELETE /v1/files/file-630021438843 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:47,580 uvicorn.access:480 server: ::1:57282 - "DELETE /v1/files/file-630021438844 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:47,672 uvicorn.access:480 server: ::1:57282 - "DELETE /v1/files/file-630021438845 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:47,677 uvicorn.access:480 server: ::1:57282 - "DELETE /v1/files/file-630021438846 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:47,681 uvicorn.access:480 server: ::1:57282 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:47,855 uvicorn.access:480 server: ::1:57282 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:48,119 uvicorn.access:480 server: ::1:57282 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:48,243 uvicorn.access:480 server: ::1:57282 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:48,863 uvicorn.access:480 server: ::1:57282 - "POST                                           
         /v1/vector_stores/vs_84becef0-82c5-45ad-bd42-0bb5a9b13d3b/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:49,028 uvicorn.access:480 server: ::1:57282 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:49,033 uvicorn.access:480 server: ::1:57282 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:50,746 uvicorn.access:480 server: ::1:57282 - "POST                                           
         /v1/vector_stores/vs_84becef0-82c5-45ad-bd42-0bb5a9b13d3b/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:50,757 uvicorn.access:480 server: ::1:57282 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:50,963 uvicorn.access:480 server: ::1:57282 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:52,375 uvicorn.access:480 server: ::1:57282 - "POST                                           
         /v1/vector_stores/vs_84becef0-82c5-45ad-bd42-0bb5a9b13d3b/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:52,421 uvicorn.access:480 server: ::1:57282 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:52,504 uvicorn.access:480 server: ::1:57282 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:53,264 uvicorn.access:480 server: ::1:57282 - "POST                                           
         /v1/vector_stores/vs_84becef0-82c5-45ad-bd42-0bb5a9b13d3b/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 3ca6b5aa49213562e8abfdcc3f8db0703cd4866f8774b8ad372b932192582097
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:09:53,917 uvicorn.access:480 server: ::1:57282 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:09:53,918 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         3ca6b5aa49213562e8abfdcc3f8db0703cd4866f8774b8ad372b932192582097                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:09:55,034 uvicorn.access:480 server: ::1:57292 - "DELETE                                         
         /v1/vector_stores/vs_84becef0-82c5-45ad-bd42-0bb5a9b13d3b HTTP/1.1" 200                                        
INFO     2026-02-17 17:09:55,053 uvicorn.access:480 server: ::1:57292 - "DELETE /v1/files/file-664068282482 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:55,077 uvicorn.access:480 server: ::1:57292 - "DELETE /v1/files/file-664068282483 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:55,142 uvicorn.access:480 server: ::1:57292 - "DELETE /v1/files/file-664068282484 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:55,163 uvicorn.access:480 server: ::1:57292 - "DELETE /v1/files/file-664068282485 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:09:55,167 uvicorn.access:480 server: ::1:57292 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:09:55,469 uvicorn.access:480 server: ::1:57292 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:09:55,499 uvicorn.access:480 server: ::1:57292 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:55,522 uvicorn.access:480 server: ::1:57292 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:56,486 uvicorn.access:480 server: ::1:57292 - "POST                                           
         /v1/vector_stores/vs_a92ceeae-9a88-4901-b796-31c2f27092e1/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:56,636 uvicorn.access:480 server: ::1:57292 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:56,641 uvicorn.access:480 server: ::1:57292 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:57,910 uvicorn.access:480 server: ::1:57292 - "POST                                           
         /v1/vector_stores/vs_a92ceeae-9a88-4901-b796-31c2f27092e1/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:57,918 uvicorn.access:480 server: ::1:57292 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:57,927 uvicorn.access:480 server: ::1:57292 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:09:59,501 uvicorn.access:480 server: ::1:57292 - "POST                                           
         /v1/vector_stores/vs_a92ceeae-9a88-4901-b796-31c2f27092e1/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:09:59,577 uvicorn.access:480 server: ::1:57292 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:09:59,648 uvicorn.access:480 server: ::1:57292 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:00,261 uvicorn.access:480 server: ::1:57292 - "POST                                           
         /v1/vector_stores/vs_a92ceeae-9a88-4901-b796-31c2f27092e1/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 46c234c52e7cd19d514f041f95d58b7ce847500f1080010874aac00e65b7c931
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:10:00,987 uvicorn.access:480 server: ::1:57292 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:10:00,988 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         46c234c52e7cd19d514f041f95d58b7ce847500f1080010874aac00e65b7c931                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:10:02,028 uvicorn.access:480 server: ::1:57780 - "DELETE                                         
         /v1/vector_stores/vs_a92ceeae-9a88-4901-b796-31c2f27092e1 HTTP/1.1" 200                                        
INFO     2026-02-17 17:10:02,053 uvicorn.access:480 server: ::1:57780 - "DELETE /v1/files/file-710505118846 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:02,091 uvicorn.access:480 server: ::1:57780 - "DELETE /v1/files/file-710505118847 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:02,105 uvicorn.access:480 server: ::1:57780 - "DELETE /v1/files/file-710505118848 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:02,214 uvicorn.access:480 server: ::1:57780 - "DELETE /v1/files/file-710505118849 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:02,218 uvicorn.access:480 server: ::1:57780 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:10:02,381 uvicorn.access:480 server: ::1:57780 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:10:02,484 uvicorn.access:480 server: ::1:57780 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:02,540 uvicorn.access:480 server: ::1:57780 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:02,913 uvicorn.access:480 server: ::1:57780 - "POST                                           
         /v1/vector_stores/vs_4c810857-0760-4f7a-bc58-61d2b1d9de7d/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:10:02,919 uvicorn.access:480 server: ::1:57780 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:02,958 uvicorn.access:480 server: ::1:57780 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:04,469 uvicorn.access:480 server: ::1:57780 - "POST                                           
         /v1/vector_stores/vs_4c810857-0760-4f7a-bc58-61d2b1d9de7d/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:10:04,549 uvicorn.access:480 server: ::1:57780 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:04,564 uvicorn.access:480 server: ::1:57780 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:06,862 uvicorn.access:480 server: ::1:57780 - "POST                                           
         /v1/vector_stores/vs_4c810857-0760-4f7a-bc58-61d2b1d9de7d/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:10:06,867 uvicorn.access:480 server: ::1:57780 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:06,906 uvicorn.access:480 server: ::1:57780 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:09,039 uvicorn.access:480 server: ::1:57780 - "POST                                           
         /v1/vector_stores/vs_4c810857-0760-4f7a-bc58-61d2b1d9de7d/files HTTP/1.1" 200                                  
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 1e0de18c47d520da2536915eef41b2644e9cbc216b88bbc9f88611305ebacad8
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:10:14,657 uvicorn.access:480 server: ::1:57780 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:10:14,658 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         1e0de18c47d520da2536915eef41b2644e9cbc216b88bbc9f88611305ebacad8                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:10:15,750 uvicorn.access:480 server: ::1:36588 - "DELETE                                         
         /v1/vector_stores/vs_4c810857-0760-4f7a-bc58-61d2b1d9de7d HTTP/1.1" 200                                        
INFO     2026-02-17 17:10:15,896 uvicorn.access:480 server: ::1:36588 - "DELETE /v1/files/file-66545595855 HTTP/1.1" 200
INFO     2026-02-17 17:10:15,909 uvicorn.access:480 server: ::1:36588 - "DELETE /v1/files/file-66545595856 HTTP/1.1" 200
INFO     2026-02-17 17:10:15,918 uvicorn.access:480 server: ::1:36588 - "DELETE /v1/files/file-66545595857 HTTP/1.1" 200
INFO     2026-02-17 17:10:15,944 uvicorn.access:480 server: ::1:36588 - "DELETE /v1/files/file-66545595858 HTTP/1.1" 200
INFO     2026-02-17 17:10:15,949 uvicorn.access:480 server: ::1:36588 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:10:16,153 uvicorn.access:480 server: ::1:36588 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:10:16,186 uvicorn.access:480 server: ::1:36588 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:16,337 uvicorn.access:480 server: ::1:36588 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:18,162 uvicorn.access:480 server: ::1:36588 - "POST                                           
         /v1/vector_stores/vs_c5f31352-a0ab-4282-a60b-aa1d38463fb0/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:10:18,188 uvicorn.access:480 server: ::1:36588 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:18,243 uvicorn.access:480 server: ::1:36588 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:19,915 uvicorn.access:480 server: ::1:36588 - "POST                                           
         /v1/vector_stores/vs_c5f31352-a0ab-4282-a60b-aa1d38463fb0/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:10:19,994 uvicorn.access:480 server: ::1:36588 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:20,011 uvicorn.access:480 server: ::1:36588 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:21,400 uvicorn.access:480 server: ::1:36588 - "POST                                           
         /v1/vector_stores/vs_c5f31352-a0ab-4282-a60b-aa1d38463fb0/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:10:21,416 uvicorn.access:480 server: ::1:36588 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:21,427 uvicorn.access:480 server: ::1:36588 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:22,439 uvicorn.access:480 server: ::1:36588 - "POST                                           
         /v1/vector_stores/vs_c5f31352-a0ab-4282-a60b-aa1d38463fb0/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:10:22,442 uvicorn.access:480 server: ::1:36588 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:23,898 uvicorn.access:480 server: ::1:36588 - "DELETE                                         
         /v1/vector_stores/vs_c5f31352-a0ab-4282-a60b-aa1d38463fb0 HTTP/1.1" 200                                        
INFO     2026-02-17 17:10:23,920 uvicorn.access:480 server: ::1:36588 - "DELETE /v1/files/file-450428750202 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:23,925 uvicorn.access:480 server: ::1:36588 - "DELETE /v1/files/file-450428750203 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:23,963 uvicorn.access:480 server: ::1:36588 - "DELETE /v1/files/file-450428750204 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:24,010 uvicorn.access:480 server: ::1:36588 - "DELETE /v1/files/file-450428750205 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:24,015 uvicorn.access:480 server: ::1:46224 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:10:24,185 uvicorn.access:480 server: ::1:46224 - "DELETE                                         
         /v1/vector_stores/vs_212e0e4e-7c5d-41a7-a233-fb7b6daab181 HTTP/1.1" 200                                        
INFO     2026-02-17 17:10:24,568 uvicorn.access:480 server: ::1:46224 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:10:24,595 uvicorn.access:480 server: ::1:46224 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:24,705 uvicorn.access:480 server: ::1:46224 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:26,332 uvicorn.access:480 server: ::1:46224 - "POST                                           
         /v1/vector_stores/vs_cce2407b-37ba-4f56-b6c2-65da292c2e2a/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:10:26,345 uvicorn.access:480 server: ::1:46224 - "GET                                            
         /v1/vector_stores/vs_cce2407b-37ba-4f56-b6c2-65da292c2e2a/files/file-379221123213 HTTP/1.1" 200                
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 144d2b3be3a0c0053d3d8958cb6b3c500bec3593df9af2130f50d0b4174a413e
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:10:27,142 uvicorn.access:480 server: ::1:46224 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:10:27,143 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         144d2b3be3a0c0053d3d8958cb6b3c500bec3593df9af2130f50d0b4174a413e                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:10:27,566 uvicorn.access:480 server: ::1:36588 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:10:27,785 uvicorn.access:480 server: ::1:36588 - "DELETE                                         
         /v1/vector_stores/vs_cce2407b-37ba-4f56-b6c2-65da292c2e2a HTTP/1.1" 200                                        
INFO     2026-02-17 17:10:27,943 uvicorn.access:480 server: ::1:36588 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:10:30,173 uvicorn.access:480 server: ::1:36588 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:30,181 uvicorn.access:480 server: ::1:36588 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:10:30,289 uvicorn.access:480 server: ::1:36588 - "DELETE                                         
         /v1/vector_stores/vs_a30c16bc-357a-4cb1-a284-8e3ebab16adf HTTP/1.1" 200                                        
INFO     2026-02-17 17:10:30,453 uvicorn.access:480 server: ::1:36588 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:10:30,591 uvicorn.access:480 server: ::1:36588 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:30,640 uvicorn.access:480 server: ::1:36588 - "DELETE /v1/files/file-528246887823 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:30,644 uvicorn.access:480 server: ::1:36588 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:10:31,717 uvicorn.access:480 server: ::1:36588 - "POST                                           
         /v1/vector_stores/vs_6b7a143f-f6ae-486b-bf31-4f070a699f25/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:10:31,732 uvicorn.access:480 server: ::1:36588 - "GET                                            
         /v1/vector_stores/vs_6b7a143f-f6ae-486b-bf31-4f070a699f25/files/file-797509666839 HTTP/1.1" 200                
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 8ddd5d24c9c0345fcb59940587cd01552990e25a0cda2ca26078b3076e50a8b0
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:10:32,732 uvicorn.access:480 server: ::1:36588 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:10:32,733 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         8ddd5d24c9c0345fcb59940587cd01552990e25a0cda2ca26078b3076e50a8b0                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:10:33,798 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:34,407 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 400               
INFO     2026-02-17 17:10:35,478 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:36,032 uvicorn.access:480 server: ::1:47054 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:36,508 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
ERROR    2026-02-17 17:10:37,241 llama_stack.providers.inline.agents.meta_reference.responses.streaming:1375            
         agents::meta_reference: Failed to list MCP tools from http://localhost:47097/sse: Client error '401            
         Unauthorized' for url 'http://localhost:47097/sse'                                                             
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401                       
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/mcp/client/sse.py:74 in sse_client                                  │
         │                                                                                                             │
         │    71 │   │   │   │   │   "GET",                                                                            │
         │    72 │   │   │   │   │   url,                                                                              │
         │    73 │   │   │   │   ) as event_source:                                                                    │
         │ ❱  74 │   │   │   │   │   event_source.response.raise_for_status()                                          │
         │    75 │   │   │   │   │   logger.debug("SSE connection established")                                        │
         │    76 │   │   │   │   │                                                                                     │
         │    77 │   │   │   │   │   async def sse_reader(                                                             │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/httpx/_models.py:829 in raise_for_status                            │
         │                                                                                                             │
         │    826 │   │   }                                                                                            │
         │    827 │   │   error_type = error_types.get(status_class, "Invalid status code")                            │
         │    828 │   │   message = message.format(self, error_type=error_type)                                        │
         │ ❱  829 │   │   raise HTTPStatusError(message, request=request, response=self)                               │
         │    830 │                                                                                                    │
         │    831 │   def json(self, **kwargs: typing.Any) -> typing.Any:                                              │
         │    832 │   │   return jsonlib.loads(self.content, **kwargs)                                                 │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         HTTPStatusError: Client error '401 Unauthorized' for url 'http://localhost:47097/sse'                          
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401                       
                                                                                                                        
         The above exception was the direct cause of the following exception:                                           
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py:1322 in            │
         │ _process_mcp_tool                                                                                           │
         │                                                                                                             │
         │   1319 │   │   │   # TODO: follow semantic conventions for Open Telemetry tool spans                        │
         │   1320 │   │   │   #                                                                                        │
         │        https://opentelemetry.io/docs/specs/semconv/gen-ai/gen-ai-spans/#execute-tool-span                   │
         │   1321 │   │   │   with tracer.start_as_current_span("list_mcp_tools", attributes=attributes):              │
         │ ❱ 1322 │   │   │   │   tool_defs = await list_mcp_tools(                                                    │
         │   1323 │   │   │   │   │   endpoint=mcp_tool.server_url,                                                    │
         │   1324 │   │   │   │   │   headers=mcp_tool.headers,                                                        │
         │   1325 │   │   │   │   │   authorization=mcp_tool.authorization,                                            │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:404 in list_mcp_tools                               │
         │                                                                                                             │
         │   401 │                                                                                                     │
         │   402 │   # If a session manager is provided, use it for session reuse (fix for #4452)                      │
         │   403 │   if session_manager is not None:                                                                   │
         │ ❱ 404 │   │   session = await session_manager.get_session(endpoint, final_headers)                          │
         │   405 │   │   await _list_tools_from_session(session)                                                       │
         │   406 │   else:                                                                                             │
         │   407 │   │   # Fallback to original behavior: create a new session for this call                           │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:144 in get_session                                  │
         │                                                                                                             │
         │   141 │   │   │   │   return session                                                                        │
         │   142 │   │   │                                                                                             │
         │   143 │   │   │   # Create new session                                                                      │
         │ ❱ 144 │   │   │   session, client_ctx, session_ctx = await self._create_session(endpoint,                   │
         │       headers)                                                                                              │
         │   145 │   │   │   self._sessions[key] = (session, client_ctx, session_ctx)                                  │
         │   146 │   │   │   logger.debug(f"Created new MCP session for {endpoint} (key: {key[:32]}...)")              │
         │   147 │   │   │   return session                                                                            │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:194 in _create_session                              │
         │                                                                                                             │
         │   191 │   │   │   │   for exc in eg.exceptions:                                                             │
         │   192 │   │   │   │   │   err = cast(httpx.HTTPStatusError, exc)                                            │
         │   193 │   │   │   │   │   if err.response.status_code == 401:                                               │
         │ ❱ 194 │   │   │   │   │   │   raise AuthenticationRequiredError(exc) from exc                               │
         │   195 │   │   │   │   if i == len(connection_strategies) - 1:                                               │
         │   196 │   │   │   │   │   raise                                                                             │
         │   197 │   │   │   │   last_exception = eg                                                                   │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         AuthenticationRequiredError: Client error '401 Unauthorized' for url 'http://localhost:47097/sse'              
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401                       
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/mcp/client/sse.py", line 74, in sse_client
    event_source.response.raise_for_status()
  File "/usr/local/lib/python3.12/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'http://localhost:47097/sse'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 550, in create_openai_response
    async for stream_chunk in stream_gen:
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 681, in _create_streaming_response
    async for stream_chunk in orchestrator.create_response():
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 318, in create_response
    async for stream_event in self._process_tools(output_messages):
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1389, in _process_tools
    async for stream_event in self._process_new_tools(
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1279, in _process_new_tools
    async for stream_event in self._process_mcp_tool(input_tool, output_messages):
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1322, in _process_mcp_tool
    tool_defs = await list_mcp_tools(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 404, in list_mcp_tools
    session = await session_manager.get_session(endpoint, final_headers)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 144, in get_session
    session, client_ctx, session_ctx = await self._create_session(endpoint, headers)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 194, in _create_session
    raise AuthenticationRequiredError(exc) from exc
llama_stack.core.datatypes.AuthenticationRequiredError: Client error '401 Unauthorized' for url 'http://localhost:47097/sse'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
INFO     2026-02-17 17:10:37,396 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 401               
INFO     2026-02-17 17:10:37,690 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:38,567 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:38,794 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:39,526 llama_stack.providers.inline.agents.meta_reference.responses.streaming:581             
         agents::meta_reference: Requesting approval for call_giaayybgGw4kjFpGbbfesoBN on get_boiling_point             
INFO     2026-02-17 17:10:39,601 uvicorn.access:480 server: ::1:47054 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:39,664 llama_stack.providers.inline.agents.meta_reference.responses.streaming:578             
         agents::meta_reference: Approval denied for call_giaayybgGw4kjFpGbbfesoBN on get_boiling_point                 
INFO     2026-02-17 17:10:39,704 uvicorn.access:480 server: ::1:47054 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:40,223 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:10:40,233 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:40,253 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:10:40,263 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:40,473 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:40,507 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:10:40,522 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:40,591 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:41,603 uvicorn.access:480 server: ::1:47054 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:42,216 uvicorn.access:480 server: ::1:47054 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:43,611 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:10:43,706 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 466, in app
    raise validation_error
fastapi.exceptions.RequestValidationError: 1 validation error:
  {'type': 'greater_than_equal', 'loc': ('body', 'max_tool_calls'), 'msg': 'Input should be greater than or equal to 1', 'input': 0, 'ctx': {'ge': 1}}

  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 219, in create_openai_response
    POST /v1/responses
INFO     2026-02-17 17:10:43,710 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 400               
INFO     2026-02-17 17:10:45,336 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:46,036 llama_stack.providers.inline.agents.meta_reference.responses.streaming:1122            
         agents::meta_reference: Ignoring built-in and mcp tool call since reached the limit of self.max_tool_calls=1.  
INFO     2026-02-17 17:10:46,423 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:47,418 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:48,443 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:10:48,825 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:49,021 llama_stack.providers.inline.agents.meta_reference.responses.streaming:491             
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call               
INFO     2026-02-17 17:10:49,322 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:50,693 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:52,328 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:53,524 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:53,589 uvicorn.access:480 server: ::1:35134 - "GET                                            
         /v1/responses/resp_7b023ab2-f4f4-494e-8df5-1f66f60e1f7f HTTP/1.1" 200                                          
INFO     2026-02-17 17:10:54,813 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:54,817 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:54,988 uvicorn.access:480 server: ::1:35134 - "GET                                            
         /v1/responses/resp_7256a3e9-ecdf-43bf-a540-730be73b8ccc HTTP/1.1" 200                                          
INFO     2026-02-17 17:10:54,993 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:56,255 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:56,515 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:10:56,521 uvicorn.access:480 server: ::1:35134 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:10:57,751 uvicorn.access:480 server: ::1:35134 - "DELETE                                         
         /v1/vector_stores/vs_6b7a143f-f6ae-486b-bf31-4f070a699f25 HTTP/1.1" 200                                        
INFO     2026-02-17 17:10:59,356 uvicorn.access:480 server: ::1:35134 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:10:59,537 uvicorn.access:480 server: ::1:35134 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:10:59,624 uvicorn.access:480 server: ::1:35134 - "DELETE /v1/files/file-861837565219 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:10:59,633 uvicorn.access:480 server: ::1:35134 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:11:15,174 uvicorn.access:480 server: ::1:35134 - "POST                                           
         /v1/vector_stores/vs_e54f2770-4abc-45e7-a131-878d8db54651/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:11:15,442 uvicorn.access:480 server: ::1:35134 - "GET                                            
         /v1/vector_stores/vs_e54f2770-4abc-45e7-a131-878d8db54651/files/file-864460993305 HTTP/1.1" 200                
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 02a5cc72a0174cceecb73e622b19febbea1ed7f3c555214f5e6d4b77d9ffbcf0
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:11:27,665 uvicorn.access:480 server: ::1:35134 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:11:27,666 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         02a5cc72a0174cceecb73e622b19febbea1ed7f3c555214f5e6d4b77d9ffbcf0                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:11:29,681 llama_stack.providers.inline.agents.meta_reference.responses.streaming:581             
         agents::meta_reference: Requesting approval for call_Eps4RVKUQK4eJUXk4BST41as on get_boiling_point             
INFO     2026-02-17 17:11:30,308 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:30,997 llama_stack.providers.inline.agents.meta_reference.responses.streaming:575             
         agents::meta_reference: Approval granted for call_Eps4RVKUQK4eJUXk4BST41as on get_boiling_point                
INFO     2026-02-17 17:11:31,186 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:32,280 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:32,892 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:33,624 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:33,635 uvicorn.access:480 server: ::1:52762 - "GET                                            
         /v1/responses/resp_927b1e5c-11f1-437e-a8ef-9cc8be4c4b05 HTTP/1.1" 200                                          
INFO     2026-02-17 17:11:33,826 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:33,830 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:33,894 uvicorn.access:480 server: ::1:52762 - "GET                                            
         /v1/responses/resp_0de91ff6-cabe-4239-b95d-f5fc10e767d9 HTTP/1.1" 200                                          
INFO     2026-02-17 17:11:33,898 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:33,983 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:34,134 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:34,140 uvicorn.access:480 server: ::1:52762 - "GET /v1/vector_stores HTTP/1.1" 200            
INFO     2026-02-17 17:11:34,324 uvicorn.access:480 server: ::1:52762 - "DELETE                                         
         /v1/vector_stores/vs_e54f2770-4abc-45e7-a131-878d8db54651 HTTP/1.1" 200                                        
INFO     2026-02-17 17:11:34,522 uvicorn.access:480 server: ::1:52762 - "POST /v1/vector_stores HTTP/1.1" 200           
INFO     2026-02-17 17:11:34,591 uvicorn.access:480 server: ::1:52762 - "GET /v1/files HTTP/1.1" 200                    
INFO     2026-02-17 17:11:34,614 uvicorn.access:480 server: ::1:52762 - "DELETE /v1/files/file-379221123213 HTTP/1.1"   
         200                                                                                                            
INFO     2026-02-17 17:11:34,623 uvicorn.access:480 server: ::1:52762 - "POST /v1/files HTTP/1.1" 200                   
INFO     2026-02-17 17:11:36,416 uvicorn.access:480 server: ::1:52762 - "POST                                           
         /v1/vector_stores/vs_ed3fcbe7-e3bd-4bc9-bc1b-947351946806/files HTTP/1.1" 200                                  
INFO     2026-02-17 17:11:36,423 uvicorn.access:480 server: ::1:52762 - "GET                                            
         /v1/vector_stores/vs_ed3fcbe7-e3bd-4bc9-bc1b-947351946806/files/file-156847829497 HTTP/1.1" 200                
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 119, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 105, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 159, in handler
    resp: Response = await original(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 424, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 312, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 238, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 571, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: fe05f9fa5890ff7b712e83e97c815d383b0b76009940405aee32f0763966aabd
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-17 17:11:37,225 uvicorn.access:480 server: ::1:52762 - "POST /v1/responses HTTP/1.1" 500               
ERROR    2026-02-17 17:11:37,226 uvicorn.error:415 server: Exception in ASGI application                                
                                                                                                                        
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1134 in __call__                            │
         │                                                                                                             │
         │   1131 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1132 │   │   if self.root_path:                                                                           │
         │   1133 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1134 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1135 │                                                                                                    │
         │   1136 │   def add_api_route(                                                                               │
         │   1137 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:119 in app                                       │
         │                                                                                                             │
         │    116 │   │   │   │   )                                                                                    │
         │    117 │   │                                                                                                │
         │    118 │   │   # Same as in Starlette                                                                       │
         │ ❱  119 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    120 │                                                                                                    │
         │    121 │   return app                                                                                       │
         │    122                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:105 in app                                       │
         │                                                                                                             │
         │    102 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    103 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    104 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  105 │   │   │   │   │   response = await f(request)                                                      │
         │    106 │   │   │   │   await response(scope, receive, send)                                                 │
         │    107 │   │   │   │   # Continues customization                                                            │
         │    108 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:159 in handler                                      │
         │                                                                                                             │
         │   156 │   │                                                                                                 │
         │   157 │   │   async def handler(request: Request) -> Response:                                              │
         │   158 │   │   │   try:                                                                                      │
         │ ❱ 159 │   │   │   │   resp: Response = await original(request)                                              │
         │   160 │   │   │   except Exception as exc:                                                                  │
         │   161 │   │   │   │   http_exc = _try_translate_to_http_exception(exc)                                      │
         │   162 │   │   │   │   if http_exc is not None:                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:424 in app                                       │
         │                                                                                                             │
         │    421 │   │   )                                                                                            │
         │    422 │   │   errors = solved_result.errors                                                                │
         │    423 │   │   if not errors:                                                                               │
         │ ❱  424 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    425 │   │   │   │   dependant=dependant,                                                                 │
         │    426 │   │   │   │   values=solved_result.values,                                                         │
         │    427 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:312 in run_endpoint_function                     │
         │                                                                                                             │
         │    309 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    310 │                                                                                                    │
         │    311 │   if is_coroutine:                                                                                 │
         │ ❱  312 │   │   return await dependant.call(**values)                                                        │
         │    313 │   else:                                                                                            │
         │    314 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    315                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:238 in create_openai_response                       │
         │                                                                                                             │
         │   235 │   async def create_openai_response(                                                                 │
         │   236 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   237 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │ ❱ 238 │   │   result = await impl.create_openai_response(request)                                           │
         │   239 │   │                                                                                                 │
         │   240 │   │   # For streaming responses, wrap in StreamingResponse for HTTP requests.                       │
         │   241 │   │   # The implementation is typed to return an `AsyncIterator` for streaming.                     │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:571 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   568 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   569 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   570 │   │   │   │   )                                                                                     │
         │ ❱ 571 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   572 │   │   │                                                                                             │
         │   573 │   │   │   if final_response is None:                                                                │
         │   574 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:                                    
         fe05f9fa5890ff7b712e83e97c815d383b0b76009940405aee32f0763966aabd                                               
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions                                    
                                                                                                                        
         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.    
INFO     2026-02-17 17:11:38,982 llama_stack.providers.inline.agents.meta_reference.responses.streaming:581             
         agents::meta_reference: Requesting approval for call_upVpEp6APgdHdCjgOVigifl3 on get_boiling_point             
INFO     2026-02-17 17:11:39,143 uvicorn.access:480 server: ::1:33462 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:39,794 llama_stack.providers.inline.agents.meta_reference.responses.streaming:578             
         agents::meta_reference: Approval denied for call_upVpEp6APgdHdCjgOVigifl3 on get_boiling_point                 
INFO     2026-02-17 17:11:39,814 uvicorn.access:480 server: ::1:33462 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:41,140 uvicorn.access:480 server: ::1:33462 - "POST /v1/responses HTTP/1.1" 200               
INFO     2026-02-17 17:11:41,754 uvicorn.access:480 server: ::1:33462 - "POST /v1/responses HTTP/1.1" 200               
