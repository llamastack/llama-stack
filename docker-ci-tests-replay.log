INFO     2026-02-11 22:20:31,024 llama_stack.cli.stack.run:147 cli: Using stack configuration:
         /workspace/src/llama_stack/distributions/ci-tests/config.yaml
INFO     2026-02-11 22:20:31,058 llama_stack.cli.stack.run:206 cli: HTTPS enabled with certificates:
           Key: None
           Cert: None
INFO     2026-02-11 22:20:31,058 llama_stack.cli.stack.run:208 cli: Listening on ['::', '0.0.0.0']:8322
INFO     2026-02-11 22:20:31,140 llama_stack.core.server.server:553 core::server: Stack Configuration:
INFO     2026-02-11 22:20:31,148 llama_stack.core.server.server:556 core::server: apis:
         - agents
         - batches
         - datasetio
         - eval
         - file_processors
         - files
         - inference
         - post_training
         - safety
         - scoring
         - tool_runtime
         - vector_io
         connectors: []
         distro_name: ci-tests
         providers:
           agents:
           - config:
               persistence:
                 agent_state:
                   backend: kv_default
                   namespace: agents
                 responses:
                   backend: sql_default
                   max_write_queue_size: 10000
                   num_writers: 4
                   table_name: responses
             provider_id: meta-reference
             provider_type: inline::meta-reference
           batches:
           - config:
               kvstore:
                 backend: kv_default
                 namespace: batches
             provider_id: reference
             provider_type: inline::reference
           datasetio:
           - config:
               kvstore:
                 backend: kv_default
                 namespace: datasetio::huggingface
             provider_id: huggingface
             provider_type: remote::huggingface
           - config:
               kvstore:
                 backend: kv_default
                 namespace: datasetio::localfs
             provider_id: localfs
             provider_type: inline::localfs
           eval:
           - config:
               kvstore:
                 backend: kv_default
                 namespace: eval
             provider_id: meta-reference
             provider_type: inline::meta-reference
           file_processors:
           - config: {}
             provider_id: pypdf
             provider_type: inline::pypdf
           files:
           - config:
               metadata_store:
                 backend: sql_default
                 table_name: files_metadata
               storage_dir: /root/.llama/distributions/ci-tests/files
             provider_id: meta-reference-files
             provider_type: inline::localfs
           inference:
           - config:
               api_key: '********'
               base_url: https://api.fireworks.ai/inference/v1
             provider_id: fireworks
             provider_type: remote::fireworks
           - config:
               api_key: '********'
               base_url: https://api.together.xyz/v1
             provider_id: together
             provider_type: remote::together
           - config:
               api_key: '********'
               region_name: us-east-2
             provider_id: bedrock
             provider_type: remote::bedrock
           - config:
               api_key: '********'
               base_url: https://api.openai.com/v1
             provider_id: openai
             provider_type: remote::openai
           - config:
               api_key: '********'
             provider_id: anthropic
             provider_type: remote::anthropic
           - config:
               api_key: '********'
             provider_id: gemini
             provider_type: remote::gemini
           - config:
               api_key: '********'
               base_url: https://api.groq.com/openai/v1
             provider_id: groq
             provider_type: remote::groq
           - config:
               api_key: '********'
               base_url: https://api.sambanova.ai/v1
             provider_id: sambanova
             provider_type: remote::sambanova
           - config: {}
             provider_id: sentence-transformers
             provider_type: inline::sentence-transformers
           post_training:
           - config:
               checkpoint_format: meta
             provider_id: torchtune-cpu
             provider_type: inline::torchtune-cpu
           safety:
           - config:
               excluded_categories: []
             provider_id: llama-guard
             provider_type: inline::llama-guard
           - config: {}
             provider_id: code-scanner
             provider_type: inline::code-scanner
           scoring:
           - config: {}
             provider_id: basic
             provider_type: inline::basic
           - config: {}
             provider_id: llm-as-judge
             provider_type: inline::llm-as-judge
           - config:
               openai_api_key: '********'
             provider_id: braintrust
             provider_type: inline::braintrust
           tool_runtime:
           - config:
               api_key: '********'
               max_results: 3
             provider_id: brave-search
             provider_type: remote::brave-search
           - config:
               api_key: '********'
               max_results: 3
             provider_id: tavily-search
             provider_type: remote::tavily-search
           - config: {}
             provider_id: rag-runtime
             provider_type: inline::rag-runtime
           - config: {}
             provider_id: model-context-protocol
             provider_type: remote::model-context-protocol
           vector_io:
           - config:
               persistence:
                 backend: kv_default
                 namespace: vector_io::faiss
             provider_id: faiss
             provider_type: inline::faiss
           - config:
               db_path: /root/.llama/distributions/ci-tests/sqlite_vec.db
               persistence:
                 backend: kv_default
                 namespace: vector_io::sqlite_vec
             provider_id: sqlite-vec
             provider_type: inline::sqlite-vec
         registered_resources:
           benchmarks: []
           datasets: []
           models:
           - metadata:
               description: OpenAI GPT-OSS 20B on Bedrock (us-west-2)
             model_id: openai.gpt-oss-20b-1:0
             model_type: llm
             provider_id: bedrock
             provider_model_id: openai.gpt-oss-20b-1:0
           scoring_fns: []
           shields: []
           tool_groups:
           - provider_id: tavily-search
             toolgroup_id: builtin::websearch
           - provider_id: rag-runtime
             toolgroup_id: builtin::rag
           vector_stores: []
         safety:
           default_shield_id: llama-guard
         server:
           port: 8321
           workers: 1
         storage:
           backends:
             kv_default:
               db_path: /root/.llama/distributions/ci-tests/kvstore.db
               type: kv_sqlite
             sql_default:
               db_path: /root/.llama/distributions/ci-tests/sql_store.db
               type: sql_sqlite
           stores:
             connectors:
               backend: kv_default
               namespace: connectors
             conversations:
               backend: sql_default
               table_name: openai_conversations
             inference:
               backend: sql_default
               max_write_queue_size: 10000
               num_writers: 4
               table_name: inference_store
             metadata:
               backend: kv_default
               namespace: registry
             prompts:
               backend: kv_default
               namespace: prompts
         vector_stores:
           annotation_prompt_params:
             annotation_instruction_template: Cite sources immediately at the end of sentences
               before punctuation, using `<|file-id|>` format like 'This is a fact <|file-Cn3MSNn72ENTiiq11Qda4A|>.'.
               Do not add extra punctuation. Use only the file IDs provided, do not invent
               new ones.
             chunk_annotation_template: '[{index}] {metadata_text} cite as <|{file_id}|>

               {chunk_text}

               '
             enable_annotations: true
           chunk_retrieval_params:
             chunk_multiplier: 5
             default_reranker_strategy: rrf
             max_tokens_in_context: 4000
             rrf_impact_factor: 60.0
             weighted_search_alpha: 0.5
           context_prompt_params:
             chunk_annotation_template: 'Result {index}

               Content: {chunk.content}

               Metadata: {metadata}

               '
             context_template: 'The above results were retrieved to help answer the user''s
               query: "{query}". Use them as supporting information only in answering this
               query. {annotation_instruction}

               '
           default_embedding_model:
             model_id: nomic-ai/nomic-embed-text-v1.5
             provider_id: sentence-transformers
           default_provider_id: faiss
           file_batch_params:
             cleanup_interval_seconds: 86400
             file_batch_chunk_size: 10
             max_concurrent_files_per_batch: 3
           file_ingestion_params:
             default_chunk_overlap_tokens: 128
             default_chunk_size_tokens: 512
           file_search_params:
             footer_template: 'END of knowledge_search tool results.

               '
             header_template: 'knowledge_search tool found {num_chunks} chunks:

               BEGIN of knowledge_search tool results.

               '
         version: 2

INFO     2026-02-11 22:20:31,283 llama_stack.core.stack:611 core: API recording enabled: mode=replay
INFO     2026-02-11 22:20:35,202 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 138 models
INFO     2026-02-11 22:20:39,644 uvicorn.error:84 server: Started server process [1]
INFO     2026-02-11 22:20:39,645 uvicorn.error:48 server: Waiting for application startup.
INFO     2026-02-11 22:20:39,647 llama_stack.core.server.server:175 core::server: Starting up Llama Stack server
         (version: 0.5.1.dev0)
INFO     2026-02-11 22:20:39,647 llama_stack.core.stack:712 core: starting registry refresh task
INFO     2026-02-11 22:20:39,648 uvicorn.error:62 server: Application startup complete.
INFO     2026-02-11 22:20:39,649 uvicorn.error:216 server: Uvicorn running on http://['::', '0.0.0.0']:8322 (Press
         CTRL+C to quit)
INFO     2026-02-11 22:20:40,091 uvicorn.access:480 server: ::1:37708 - "GET /v1/health HTTP/1.1" 200
INFO     2026-02-11 22:20:41,620 uvicorn.access:480 server: ::1:37724 - "GET /v1/providers HTTP/1.1" 200
INFO     2026-02-11 22:20:41,632 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 138 models
INFO     2026-02-11 22:20:41,636 uvicorn.access:480 server: ::1:37724 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:20:41,908 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:41,949 uvicorn.access:480 server: ::1:37728 - "GET
         /v1/responses/resp_0544a0b7-807d-494d-aa95-4da625aaa5e2 HTTP/1.1" 200
INFO     2026-02-11 22:20:41,969 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:41,973 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,017 uvicorn.access:480 server: ::1:37728 - "GET
         /v1/responses/resp_345c8193-b440-4ce6-b3cd-2e83401b7390 HTTP/1.1" 200
INFO     2026-02-11 22:20:42,021 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,052 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,070 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,093 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,112 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,130 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,140 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models
INFO     2026-02-11 22:20:42,143 uvicorn.access:480 server: ::1:37724 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:20:42,154 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models
INFO     2026-02-11 22:20:42,157 uvicorn.access:480 server: ::1:37724 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:20:42,164 uvicorn.access:480 server: ::1:37724 - "GET /v1/providers HTTP/1.1" 200
INFO     2026-02-11 22:20:42,182 uvicorn.access:480 server: ::1:37724 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,211 uvicorn.access:480 server: ::1:37724 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,220 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models
INFO     2026-02-11 22:20:42,223 uvicorn.access:480 server: ::1:37724 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:20:42,234 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models
INFO     2026-02-11 22:20:42,236 uvicorn.access:480 server: ::1:37724 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:20:42,242 uvicorn.access:480 server: ::1:37724 - "GET /v1/providers HTTP/1.1" 200
INFO     2026-02-11 22:20:42,246 uvicorn.access:480 server: ::1:37724 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,275 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models
INFO     2026-02-11 22:20:42,278 uvicorn.access:480 server: ::1:37724 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:20:42,289 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 108 models
INFO     2026-02-11 22:20:42,292 uvicorn.access:480 server: ::1:37724 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:20:42,298 uvicorn.access:480 server: ::1:37724 - "GET /v1/providers HTTP/1.1" 200
INFO     2026-02-11 22:20:42,335 uvicorn.access:480 server: ::1:37724 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,346 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 123 models
INFO     2026-02-11 22:20:42,348 uvicorn.access:480 server: ::1:37724 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:20:42,362 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 123 models
INFO     2026-02-11 22:20:42,364 uvicorn.access:480 server: ::1:37724 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:20:42,370 uvicorn.access:480 server: ::1:37724 - "GET /v1/providers HTTP/1.1" 200
INFO     2026-02-11 22:20:42,384 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:20:42,386 uvicorn.access:480 server: ::1:37724 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,404 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:20:42,410 uvicorn.access:480 server: ::1:37728 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:20:42,567 uvicorn.access:480 server: ::1:37728 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:20:42,589 uvicorn.access:480 server: ::1:37728 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:20:42,609 uvicorn.access:480 server: ::1:37728 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:20:43,619 llama_stack.providers.utils.inference.embedding_mixin:93 providers::utils: Loading
         sentence transformer for nomic-ai/nomic-embed-text-v1.5...
WARNING  2026-02-11 22:20:49,690 torchao.kernel.intmm:21 uncategorized: Warning: Detected no triton, on systems without
         Triton certain kernels will not work
/usr/local/lib/python3.12/site-packages/torchao/quantization/quant_api.py:1825: SyntaxWarning: invalid escape sequence '\.'
  * regex for parameter names, must start with `re:`, e.g. `re:language\.layers\..+\.q_proj.weight`.
A new version of the following files was downloaded from https://huggingface.co/nomic-ai/nomic-bert-2048:
- configuration_hf_nomic_bert.py
. Make sure to double-check they do not contain any added malicious code. To avoid downloading new versions of the code file, you can pin a revision.
Warning: You are sending unauthenticated requests to the HF Hub. Please set a HF_TOKEN to enable higher rate limits and faster downloads.
WARNING  2026-02-11 22:20:51,130 huggingface_hub.utils._http:779 uncategorized: Warning: You are sending unauthenticated
         requests to the HF Hub. Please set a HF_TOKEN to enable higher rate limits and faster downloads.
A new version of the following files was downloaded from https://huggingface.co/nomic-ai/nomic-bert-2048:
- modeling_hf_nomic_bert.py
. Make sure to double-check they do not contain any added malicious code. To avoid downloading new versions of the code file, you can pin a revision.
WARNING  2026-02-11 22:21:06,074
         transformers_modules.nomic_hyphen_ai.nomic_hyphen_bert_hyphen_2048.7710840340a098cfb869c4f65e87cf2b1b70caca.mod
         eling_hf_nomic_bert:466 uncategorized: <All keys matched successfully>
INFO     2026-02-11 22:21:07,138 uvicorn.access:480 server: ::1:37728 - "POST
         /v1/vector_stores/vs_842eb9d8-89ab-4a8b-b0ce-980529b0d110/files HTTP/1.1" 200
INFO     2026-02-11 22:21:07,157 uvicorn.access:480 server: ::1:37728 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:07,167 uvicorn.access:480 server: ::1:37728 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:07,331 uvicorn.access:480 server: ::1:37728 - "POST
         /v1/vector_stores/vs_842eb9d8-89ab-4a8b-b0ce-980529b0d110/files HTTP/1.1" 200
INFO     2026-02-11 22:21:07,344 uvicorn.access:480 server: ::1:37728 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:07,355 uvicorn.access:480 server: ::1:37728 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:07,534 uvicorn.access:480 server: ::1:37728 - "POST
         /v1/vector_stores/vs_842eb9d8-89ab-4a8b-b0ce-980529b0d110/files HTTP/1.1" 200
INFO     2026-02-11 22:21:07,546 uvicorn.access:480 server: ::1:37728 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:07,554 uvicorn.access:480 server: ::1:37728 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:07,732 uvicorn.access:480 server: ::1:37728 - "POST
         /v1/vector_stores/vs_842eb9d8-89ab-4a8b-b0ce-980529b0d110/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 4145ca17956b44d9af8a25a55e568cdda43e818e81e23381c37734cdcee2183a
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:07,816 uvicorn.access:480 server: ::1:37728 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:07,817 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         4145ca17956b44d9af8a25a55e568cdda43e818e81e23381c37734cdcee2183a
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:08,255 uvicorn.access:480 server: ::1:54342 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:08,389 uvicorn.access:480 server: ::1:54342 - "DELETE
         /v1/vector_stores/vs_842eb9d8-89ab-4a8b-b0ce-980529b0d110 HTTP/1.1" 200
INFO     2026-02-11 22:21:08,553 uvicorn.access:480 server: ::1:54342 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:08,567 uvicorn.access:480 server: ::1:54342 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:08,580 uvicorn.access:480 server: ::1:54342 - "DELETE /v1/files/file-247992711530 HTTP/1.1"
         200
INFO     2026-02-11 22:21:08,589 uvicorn.access:480 server: ::1:54342 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:08,766 uvicorn.access:480 server: ::1:54342 - "POST
         /v1/vector_stores/vs_60e80dc4-da23-4701-a0f4-7218b933a460/files HTTP/1.1" 200
INFO     2026-02-11 22:21:08,779 uvicorn.access:480 server: ::1:54342 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:08,793 uvicorn.access:480 server: ::1:54342 - "DELETE /v1/files/file-247992711531 HTTP/1.1"
         200
INFO     2026-02-11 22:21:08,800 uvicorn.access:480 server: ::1:54342 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:08,977 uvicorn.access:480 server: ::1:54342 - "POST
         /v1/vector_stores/vs_60e80dc4-da23-4701-a0f4-7218b933a460/files HTTP/1.1" 200
INFO     2026-02-11 22:21:08,990 uvicorn.access:480 server: ::1:54342 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:09,004 uvicorn.access:480 server: ::1:54342 - "DELETE /v1/files/file-247992711532 HTTP/1.1"
         200
INFO     2026-02-11 22:21:09,011 uvicorn.access:480 server: ::1:54342 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:09,183 uvicorn.access:480 server: ::1:54342 - "POST
         /v1/vector_stores/vs_60e80dc4-da23-4701-a0f4-7218b933a460/files HTTP/1.1" 200
INFO     2026-02-11 22:21:09,194 uvicorn.access:480 server: ::1:54342 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:09,208 uvicorn.access:480 server: ::1:54342 - "DELETE /v1/files/file-247992711533 HTTP/1.1"
         200
INFO     2026-02-11 22:21:09,215 uvicorn.access:480 server: ::1:54342 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:09,390 uvicorn.access:480 server: ::1:54342 - "POST
         /v1/vector_stores/vs_60e80dc4-da23-4701-a0f4-7218b933a460/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 9a7fb4f0733c9e78a3aada5f0722d6f22b8d0a0155e09b42f277107e278d2570
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:09,461 uvicorn.access:480 server: ::1:54342 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:09,462 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         9a7fb4f0733c9e78a3aada5f0722d6f22b8d0a0155e09b42f277107e278d2570
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:09,874 uvicorn.access:480 server: ::1:54358 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:10,009 uvicorn.access:480 server: ::1:54358 - "DELETE
         /v1/vector_stores/vs_60e80dc4-da23-4701-a0f4-7218b933a460 HTTP/1.1" 200
INFO     2026-02-11 22:21:10,168 uvicorn.access:480 server: ::1:54358 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:10,182 uvicorn.access:480 server: ::1:54358 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,198 uvicorn.access:480 server: ::1:54358 - "DELETE /v1/files/file-824569833174 HTTP/1.1"
         200
INFO     2026-02-11 22:21:10,205 uvicorn.access:480 server: ::1:54358 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,363 uvicorn.access:480 server: ::1:54358 - "POST
         /v1/vector_stores/vs_ae8b7cb5-4e5d-436a-a807-5b1973d78645/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,377 uvicorn.access:480 server: ::1:54358 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,390 uvicorn.access:480 server: ::1:54358 - "DELETE /v1/files/file-824569833175 HTTP/1.1"
         200
INFO     2026-02-11 22:21:10,397 uvicorn.access:480 server: ::1:54358 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,568 uvicorn.access:480 server: ::1:54358 - "POST
         /v1/vector_stores/vs_ae8b7cb5-4e5d-436a-a807-5b1973d78645/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,582 uvicorn.access:480 server: ::1:54358 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,597 uvicorn.access:480 server: ::1:54358 - "DELETE /v1/files/file-824569833176 HTTP/1.1"
         200
INFO     2026-02-11 22:21:10,605 uvicorn.access:480 server: ::1:54358 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,779 uvicorn.access:480 server: ::1:54358 - "POST
         /v1/vector_stores/vs_ae8b7cb5-4e5d-436a-a807-5b1973d78645/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,792 uvicorn.access:480 server: ::1:54358 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,808 uvicorn.access:480 server: ::1:54358 - "DELETE /v1/files/file-824569833177 HTTP/1.1"
         200
INFO     2026-02-11 22:21:10,815 uvicorn.access:480 server: ::1:54358 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:10,987 uvicorn.access:480 server: ::1:54358 - "POST
         /v1/vector_stores/vs_ae8b7cb5-4e5d-436a-a807-5b1973d78645/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 8b32c4f8d586c74c7ffec07dfc09bd987503443817c489afb942ab6f7fea42f1
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:11,065 uvicorn.access:480 server: ::1:54358 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:11,065 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         8b32c4f8d586c74c7ffec07dfc09bd987503443817c489afb942ab6f7fea42f1
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:11,792 uvicorn.access:480 server: ::1:54360 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:11,926 uvicorn.access:480 server: ::1:54360 - "DELETE
         /v1/vector_stores/vs_ae8b7cb5-4e5d-436a-a807-5b1973d78645 HTTP/1.1" 200
INFO     2026-02-11 22:21:12,089 uvicorn.access:480 server: ::1:54360 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:12,102 uvicorn.access:480 server: ::1:54360 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,115 uvicorn.access:480 server: ::1:54360 - "DELETE /v1/files/file-151637398235 HTTP/1.1"
         200
INFO     2026-02-11 22:21:12,122 uvicorn.access:480 server: ::1:54360 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,297 uvicorn.access:480 server: ::1:54360 - "POST
         /v1/vector_stores/vs_fc983220-cf5c-4d26-9e8b-bb1279007568/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,310 uvicorn.access:480 server: ::1:54360 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,327 uvicorn.access:480 server: ::1:54360 - "DELETE /v1/files/file-151637398236 HTTP/1.1"
         200
INFO     2026-02-11 22:21:12,336 uvicorn.access:480 server: ::1:54360 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,514 uvicorn.access:480 server: ::1:54360 - "POST
         /v1/vector_stores/vs_fc983220-cf5c-4d26-9e8b-bb1279007568/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,523 uvicorn.access:480 server: ::1:54360 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,539 uvicorn.access:480 server: ::1:54360 - "DELETE /v1/files/file-151637398237 HTTP/1.1"
         200
INFO     2026-02-11 22:21:12,547 uvicorn.access:480 server: ::1:54360 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,715 uvicorn.access:480 server: ::1:54360 - "POST
         /v1/vector_stores/vs_fc983220-cf5c-4d26-9e8b-bb1279007568/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,728 uvicorn.access:480 server: ::1:54360 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,741 uvicorn.access:480 server: ::1:54360 - "DELETE /v1/files/file-151637398238 HTTP/1.1"
         200
INFO     2026-02-11 22:21:12,748 uvicorn.access:480 server: ::1:54360 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:12,924 uvicorn.access:480 server: ::1:54360 - "POST
         /v1/vector_stores/vs_fc983220-cf5c-4d26-9e8b-bb1279007568/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 908bd8e7aae01a2abc44dfc865eb436c3e133a8376e34dd1d4a9dd7a4091c1d4
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:12,995 uvicorn.access:480 server: ::1:54360 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:12,996 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         908bd8e7aae01a2abc44dfc865eb436c3e133a8376e34dd1d4a9dd7a4091c1d4
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:13,429 uvicorn.access:480 server: ::1:34086 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:13,562 uvicorn.access:480 server: ::1:34086 - "DELETE
         /v1/vector_stores/vs_fc983220-cf5c-4d26-9e8b-bb1279007568 HTTP/1.1" 200
INFO     2026-02-11 22:21:13,724 uvicorn.access:480 server: ::1:34086 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:13,739 uvicorn.access:480 server: ::1:34086 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:13,756 uvicorn.access:480 server: ::1:34086 - "DELETE /v1/files/file-90357487491 HTTP/1.1" 200
INFO     2026-02-11 22:21:13,763 uvicorn.access:480 server: ::1:34086 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:13,920 uvicorn.access:480 server: ::1:34086 - "POST
         /v1/vector_stores/vs_55c0d62a-dddf-4630-901e-4e6196a2a062/files HTTP/1.1" 200
INFO     2026-02-11 22:21:13,933 uvicorn.access:480 server: ::1:34086 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:13,949 uvicorn.access:480 server: ::1:34086 - "DELETE /v1/files/file-90357487492 HTTP/1.1" 200
INFO     2026-02-11 22:21:13,956 uvicorn.access:480 server: ::1:34086 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:14,125 uvicorn.access:480 server: ::1:34086 - "POST
         /v1/vector_stores/vs_55c0d62a-dddf-4630-901e-4e6196a2a062/files HTTP/1.1" 200
INFO     2026-02-11 22:21:14,138 uvicorn.access:480 server: ::1:34086 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:14,153 uvicorn.access:480 server: ::1:34086 - "DELETE /v1/files/file-90357487493 HTTP/1.1" 200
INFO     2026-02-11 22:21:14,159 uvicorn.access:480 server: ::1:34086 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:14,324 uvicorn.access:480 server: ::1:34086 - "POST
         /v1/vector_stores/vs_55c0d62a-dddf-4630-901e-4e6196a2a062/files HTTP/1.1" 200
INFO     2026-02-11 22:21:14,336 uvicorn.access:480 server: ::1:34086 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:14,351 uvicorn.access:480 server: ::1:34086 - "DELETE /v1/files/file-90357487494 HTTP/1.1" 200
INFO     2026-02-11 22:21:14,359 uvicorn.access:480 server: ::1:34086 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:14,522 uvicorn.access:480 server: ::1:34086 - "POST
         /v1/vector_stores/vs_55c0d62a-dddf-4630-901e-4e6196a2a062/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 6fe52b2deff914f843c3f29fa8e83bffb27770eb5227062fc47d49c864190170
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:14,592 uvicorn.access:480 server: ::1:34086 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:14,593 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         6fe52b2deff914f843c3f29fa8e83bffb27770eb5227062fc47d49c864190170
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:15,009 uvicorn.access:480 server: ::1:34092 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:15,144 uvicorn.access:480 server: ::1:34092 - "DELETE
         /v1/vector_stores/vs_55c0d62a-dddf-4630-901e-4e6196a2a062 HTTP/1.1" 200
INFO     2026-02-11 22:21:15,304 uvicorn.access:480 server: ::1:34092 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:15,316 uvicorn.access:480 server: ::1:34092 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,331 uvicorn.access:480 server: ::1:34092 - "DELETE /v1/files/file-862946202234 HTTP/1.1"
         200
INFO     2026-02-11 22:21:15,337 uvicorn.access:480 server: ::1:34092 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,505 uvicorn.access:480 server: ::1:34092 - "POST
         /v1/vector_stores/vs_735512c2-13ff-4c01-bbe4-4351e0ecf00b/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,519 uvicorn.access:480 server: ::1:34092 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,533 uvicorn.access:480 server: ::1:34092 - "DELETE /v1/files/file-862946202235 HTTP/1.1"
         200
INFO     2026-02-11 22:21:15,540 uvicorn.access:480 server: ::1:34092 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,708 uvicorn.access:480 server: ::1:34092 - "POST
         /v1/vector_stores/vs_735512c2-13ff-4c01-bbe4-4351e0ecf00b/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,722 uvicorn.access:480 server: ::1:34092 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,737 uvicorn.access:480 server: ::1:34092 - "DELETE /v1/files/file-862946202236 HTTP/1.1"
         200
INFO     2026-02-11 22:21:15,744 uvicorn.access:480 server: ::1:34092 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,909 uvicorn.access:480 server: ::1:34092 - "POST
         /v1/vector_stores/vs_735512c2-13ff-4c01-bbe4-4351e0ecf00b/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,921 uvicorn.access:480 server: ::1:34092 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:15,933 uvicorn.access:480 server: ::1:34092 - "DELETE /v1/files/file-862946202237 HTTP/1.1"
         200
INFO     2026-02-11 22:21:15,938 uvicorn.access:480 server: ::1:34092 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:16,104 uvicorn.access:480 server: ::1:34092 - "POST
         /v1/vector_stores/vs_735512c2-13ff-4c01-bbe4-4351e0ecf00b/files HTTP/1.1" 200
INFO     2026-02-11 22:21:16,112 uvicorn.access:480 server: ::1:34092 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:16,296 uvicorn.access:480 server: ::1:34092 - "DELETE
         /v1/vector_stores/vs_735512c2-13ff-4c01-bbe4-4351e0ecf00b HTTP/1.1" 200
INFO     2026-02-11 22:21:16,313 uvicorn.access:480 server: ::1:34092 - "DELETE /v1/files/file-284290576316 HTTP/1.1"
         200
INFO     2026-02-11 22:21:16,325 uvicorn.access:480 server: ::1:34092 - "DELETE /v1/files/file-284290576317 HTTP/1.1"
         200
INFO     2026-02-11 22:21:16,333 uvicorn.access:480 server: ::1:34092 - "DELETE /v1/files/file-284290576318 HTTP/1.1"
         200
INFO     2026-02-11 22:21:16,338 uvicorn.access:480 server: ::1:34092 - "DELETE /v1/files/file-284290576319 HTTP/1.1"
         200
INFO     2026-02-11 22:21:16,342 uvicorn.access:480 server: ::1:34092 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:16,495 uvicorn.access:480 server: ::1:34092 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:16,508 uvicorn.access:480 server: ::1:34092 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:16,520 uvicorn.access:480 server: ::1:34092 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:16,687 uvicorn.access:480 server: ::1:34092 - "POST
         /v1/vector_stores/vs_73537bb8-bad3-4d43-b516-dd7badc45f10/files HTTP/1.1" 200
INFO     2026-02-11 22:21:16,697 uvicorn.access:480 server: ::1:34092 - "GET
         /v1/vector_stores/vs_73537bb8-bad3-4d43-b516-dd7badc45f10/files/file-861837565219 HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: be6e42cd1bdf386318cf099d6ae91a93b4ab31d66e9bacd6566b8d07e23c4983
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:16,774 uvicorn.access:480 server: ::1:34092 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:16,775 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         be6e42cd1bdf386318cf099d6ae91a93b4ab31d66e9bacd6566b8d07e23c4983
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:17,283 uvicorn.access:480 server: ::1:34100 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:17,413 uvicorn.access:480 server: ::1:34100 - "DELETE
         /v1/vector_stores/vs_73537bb8-bad3-4d43-b516-dd7badc45f10 HTTP/1.1" 200
INFO     2026-02-11 22:21:17,572 uvicorn.access:480 server: ::1:34100 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:17,585 uvicorn.access:480 server: ::1:34100 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:17,597 uvicorn.access:480 server: ::1:34100 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:17,780 uvicorn.access:480 server: ::1:34100 - "POST
         /v1/vector_stores/vs_24c30eba-ac3c-4ae5-b70b-7568606898fa/files HTTP/1.1" 200
INFO     2026-02-11 22:21:17,786 uvicorn.access:480 server: ::1:34100 - "GET
         /v1/vector_stores/vs_24c30eba-ac3c-4ae5-b70b-7568606898fa/files/file-528246887823 HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 1c2f1886bc9e8d8b03ca0c0a851dc75324b82c23994345182ed0690fa3806ca6
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:17,851 uvicorn.access:480 server: ::1:34100 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:17,852 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         1c2f1886bc9e8d8b03ca0c0a851dc75324b82c23994345182ed0690fa3806ca6
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:19,053 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 400
INFO     2026-02-11 22:21:19,750 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:20,276 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 121 models
INFO     2026-02-11 22:21:20,280 uvicorn.access:480 server: ::1:34120 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:21:20,292 llama_stack.providers.utils.inference.openai_mixin:514 providers::utils:
         OpenAIInferenceAdapter.list_provider_model_ids() returned 121 models
INFO     2026-02-11 22:21:20,294 uvicorn.access:480 server: ::1:34120 - "GET /v1/models HTTP/1.1" 200
INFO     2026-02-11 22:21:20,301 uvicorn.access:480 server: ::1:34120 - "GET /v1/providers HTTP/1.1" 200
INFO     2026-02-11 22:21:20,334 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:20,520 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
ERROR    2026-02-11 22:21:21,169 llama_stack.providers.inline.agents.meta_reference.responses.streaming:1309
         agents::meta_reference: Failed to list MCP tools from http://localhost:36313/sse: Client error '401
         Unauthorized' for url 'http://localhost:36313/sse'
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/mcp/client/sse.py:74 in sse_client                                  │
         │                                                                                                             │
         │    71 │   │   │   │   │   "GET",                                                                            │
         │    72 │   │   │   │   │   url,                                                                              │
         │    73 │   │   │   │   ) as event_source:                                                                    │
         │ ❱  74 │   │   │   │   │   event_source.response.raise_for_status()                                          │
         │    75 │   │   │   │   │   logger.debug("SSE connection established")                                        │
         │    76 │   │   │   │   │                                                                                     │
         │    77 │   │   │   │   │   async def sse_reader(                                                             │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/httpx/_models.py:829 in raise_for_status                            │
         │                                                                                                             │
         │    826 │   │   }                                                                                            │
         │    827 │   │   error_type = error_types.get(status_class, "Invalid status code")                            │
         │    828 │   │   message = message.format(self, error_type=error_type)                                        │
         │ ❱  829 │   │   raise HTTPStatusError(message, request=request, response=self)                               │
         │    830 │                                                                                                    │
         │    831 │   def json(self, **kwargs: typing.Any) -> typing.Any:                                              │
         │    832 │   │   return jsonlib.loads(self.content, **kwargs)                                                 │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         HTTPStatusError: Client error '401 Unauthorized' for url 'http://localhost:36313/sse'
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

         The above exception was the direct cause of the following exception:

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py:1256 in            │
         │ _process_mcp_tool                                                                                           │
         │                                                                                                             │
         │   1253 │   │   │   # TODO: follow semantic conventions for Open Telemetry tool spans                        │
         │   1254 │   │   │   #                                                                                        │
         │        https://opentelemetry.io/docs/specs/semconv/gen-ai/gen-ai-spans/#execute-tool-span                   │
         │   1255 │   │   │   with tracer.start_as_current_span("list_mcp_tools", attributes=attributes):              │
         │ ❱ 1256 │   │   │   │   tool_defs = await list_mcp_tools(                                                    │
         │   1257 │   │   │   │   │   endpoint=mcp_tool.server_url,                                                    │
         │   1258 │   │   │   │   │   headers=mcp_tool.headers,                                                        │
         │   1259 │   │   │   │   │   authorization=mcp_tool.authorization,                                            │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:404 in list_mcp_tools                               │
         │                                                                                                             │
         │   401 │                                                                                                     │
         │   402 │   # If a session manager is provided, use it for session reuse (fix for #4452)                      │
         │   403 │   if session_manager is not None:                                                                   │
         │ ❱ 404 │   │   session = await session_manager.get_session(endpoint, final_headers)                          │
         │   405 │   │   await _list_tools_from_session(session)                                                       │
         │   406 │   else:                                                                                             │
         │   407 │   │   # Fallback to original behavior: create a new session for this call                           │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:144 in get_session                                  │
         │                                                                                                             │
         │   141 │   │   │   │   return session                                                                        │
         │   142 │   │   │                                                                                             │
         │   143 │   │   │   # Create new session                                                                      │
         │ ❱ 144 │   │   │   session, client_ctx, session_ctx = await self._create_session(endpoint,                   │
         │       headers)                                                                                              │
         │   145 │   │   │   self._sessions[key] = (session, client_ctx, session_ctx)                                  │
         │   146 │   │   │   logger.debug(f"Created new MCP session for {endpoint} (key: {key[:32]}...)")              │
         │   147 │   │   │   return session                                                                            │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:194 in _create_session                              │
         │                                                                                                             │
         │   191 │   │   │   │   for exc in eg.exceptions:                                                             │
         │   192 │   │   │   │   │   err = cast(httpx.HTTPStatusError, exc)                                            │
         │   193 │   │   │   │   │   if err.response.status_code == 401:                                               │
         │ ❱ 194 │   │   │   │   │   │   raise AuthenticationRequiredError(exc) from exc                               │
         │   195 │   │   │   │   if i == len(connection_strategies) - 1:                                               │
         │   196 │   │   │   │   │   raise                                                                             │
         │   197 │   │   │   │   last_exception = eg                                                                   │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         AuthenticationRequiredError: Client error '401 Unauthorized' for url 'http://localhost:36313/sse'
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/mcp/client/sse.py", line 74, in sse_client
    event_source.response.raise_for_status()
  File "/usr/local/lib/python3.12/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'http://localhost:36313/sse'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 542, in create_openai_response
    async for stream_chunk in stream_gen:
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 667, in _create_streaming_response
    async for stream_chunk in orchestrator.create_response():
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 282, in create_response
    async for stream_event in self._process_tools(output_messages):
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1323, in _process_tools
    async for stream_event in self._process_new_tools(
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1213, in _process_new_tools
    async for stream_event in self._process_mcp_tool(input_tool, output_messages):
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1256, in _process_mcp_tool
    tool_defs = await list_mcp_tools(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 404, in list_mcp_tools
    session = await session_manager.get_session(endpoint, final_headers)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 144, in get_session
    session, client_ctx, session_ctx = await self._create_session(endpoint, headers)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 194, in _create_session
    raise AuthenticationRequiredError(exc) from exc
llama_stack.core.datatypes.AuthenticationRequiredError: Client error '401 Unauthorized' for url 'http://localhost:36313/sse'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
INFO     2026-02-11 22:21:21,318 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 401
INFO     2026-02-11 22:21:21,370 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:22,057 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:22,083 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:22,756 llama_stack.providers.inline.agents.meta_reference.responses.streaming:520
         agents::meta_reference: Requesting approval for call_988PBvyfdY38pwgrNl5Ibm7Y on get_boiling_point
INFO     2026-02-11 22:21:22,763 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:22,778 llama_stack.providers.inline.agents.meta_reference.responses.streaming:514
         agents::meta_reference: Approval granted for call_988PBvyfdY38pwgrNl5Ibm7Y on get_boiling_point
INFO     2026-02-11 22:21:22,805 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:23,339 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:23,341 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:23,359 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:23,362 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:23,379 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:23,398 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:23,402 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:23,417 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:23,615 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:24,233 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:24,852 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:24,855 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 468, in app
    raise validation_error
fastapi.exceptions.RequestValidationError: 1 validation error:
  {'type': 'greater_than_equal', 'loc': ('body', 'max_tool_calls'), 'msg': 'Input should be greater than or equal to 1', 'input': 0, 'ctx': {'ge': 1}}

  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 192, in create_openai_response
    POST /v1/responses
INFO     2026-02-11 22:21:24,859 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 400
INFO     2026-02-11 22:21:25,028 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:25,066 llama_stack.providers.inline.agents.meta_reference.responses.streaming:1056
         agents::meta_reference: Ignoring built-in and mcp tool call since reached the limit of self.max_tool_calls=1.
INFO     2026-02-11 22:21:25,101 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:25,212 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:25,733 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:25,736 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:25,754 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:25,757 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:25,955 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,034 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,558 uvicorn.access:480 server: ::1:34116 - "POST /v1/conversations HTTP/1.1" 200
INFO     2026-02-11 22:21:26,602 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,609 uvicorn.access:480 server: ::1:34116 - "GET
         /v1/conversations/conv_a711391a0e4582bc6e48d1eb62ba64eb38233ada29154f60/items HTTP/1.1" 200
INFO     2026-02-11 22:21:26,628 uvicorn.access:480 server: ::1:34116 - "POST /v1/conversations HTTP/1.1" 200
INFO     2026-02-11 22:21:26,659 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,663 uvicorn.access:480 server: ::1:34116 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,713 uvicorn.access:480 server: ::1:50834 - "GET
         /v1/conversations/conv_b3d54a829284d502dd2319fb12ebcb7a88aa7cf9b245dd47/items HTTP/1.1" 200
INFO     2026-02-11 22:21:26,722 uvicorn.access:480 server: ::1:50834 - "POST /v1/conversations HTTP/1.1" 200
INFO     2026-02-11 22:21:26,749 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,754 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 400
INFO     2026-02-11 22:21:26,758 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 400
INFO     2026-02-11 22:21:26,778 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,797 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,823 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 468, in app
    raise validation_error
fastapi.exceptions.RequestValidationError: 1 validation error:
  {'type': 'greater_than_equal', 'loc': ('body', 'max_output_tokens'), 'msg': 'Input should be greater than or equal to 16', 'input': 15, 'ctx': {'ge': 16}}

  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 192, in create_openai_response
    POST /v1/responses
INFO     2026-02-11 22:21:26,828 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 400
INFO     2026-02-11 22:21:26,855 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,859 uvicorn.access:480 server: ::1:50834 - "GET
         /v1/responses/resp_3fc52d2b-5d17-4ef3-98b9-44267f2b477d HTTP/1.1" 200
INFO     2026-02-11 22:21:26,879 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,882 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,924 uvicorn.access:480 server: ::1:50834 - "GET
         /v1/responses/resp_352255f2-b217-48b2-9afd-a1d3cf6388a5 HTTP/1.1" 200
INFO     2026-02-11 22:21:26,927 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,976 uvicorn.access:480 server: ::1:50842 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:26,995 uvicorn.access:480 server: ::1:50842 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:27,020 uvicorn.access:480 server: ::1:50842 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:27,065 uvicorn.access:480 server: ::1:50842 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:27,083 uvicorn.access:480 server: ::1:50842 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:27,100 uvicorn.access:480 server: ::1:50834 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:27,105 uvicorn.access:480 server: ::1:50842 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:27,252 uvicorn.access:480 server: ::1:50842 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:27,258 uvicorn.access:480 server: ::1:50842 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,262 uvicorn.access:480 server: ::1:50842 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,511 uvicorn.access:480 server: ::1:50842 - "POST
         /v1/vector_stores/vs_ee76789e-c425-419b-b352-ce3c94888a3b/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,531 uvicorn.access:480 server: ::1:50842 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,535 uvicorn.access:480 server: ::1:50842 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,749 uvicorn.access:480 server: ::1:50842 - "POST
         /v1/vector_stores/vs_ee76789e-c425-419b-b352-ce3c94888a3b/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,755 uvicorn.access:480 server: ::1:50842 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,759 uvicorn.access:480 server: ::1:50842 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,935 uvicorn.access:480 server: ::1:50842 - "POST
         /v1/vector_stores/vs_ee76789e-c425-419b-b352-ce3c94888a3b/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,941 uvicorn.access:480 server: ::1:50842 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:27,947 uvicorn.access:480 server: ::1:50842 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:28,144 uvicorn.access:480 server: ::1:50842 - "POST
         /v1/vector_stores/vs_ee76789e-c425-419b-b352-ce3c94888a3b/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 71b9c29c78c8f0814c5fc24c04560ee32b67b34bf72615c896e7382f4ef835c4
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:28,300 uvicorn.access:480 server: ::1:50842 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:28,301 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         71b9c29c78c8f0814c5fc24c04560ee32b67b34bf72615c896e7382f4ef835c4
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:29,297 uvicorn.access:480 server: ::1:50852 - "DELETE
         /v1/vector_stores/vs_ee76789e-c425-419b-b352-ce3c94888a3b HTTP/1.1" 200
INFO     2026-02-11 22:21:29,304 uvicorn.access:480 server: ::1:50852 - "DELETE /v1/files/file-446066738449 HTTP/1.1"
         200
INFO     2026-02-11 22:21:29,309 uvicorn.access:480 server: ::1:50852 - "DELETE /v1/files/file-446066738450 HTTP/1.1"
         200
INFO     2026-02-11 22:21:29,313 uvicorn.access:480 server: ::1:50852 - "DELETE /v1/files/file-446066738451 HTTP/1.1"
         200
INFO     2026-02-11 22:21:29,317 uvicorn.access:480 server: ::1:50852 - "DELETE /v1/files/file-446066738452 HTTP/1.1"
         200
INFO     2026-02-11 22:21:29,320 uvicorn.access:480 server: ::1:50852 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:29,460 uvicorn.access:480 server: ::1:50852 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:29,466 uvicorn.access:480 server: ::1:50852 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:29,470 uvicorn.access:480 server: ::1:50852 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:29,666 uvicorn.access:480 server: ::1:50852 - "POST
         /v1/vector_stores/vs_0972d5db-6f6c-4123-ba83-fcef875fb548/files HTTP/1.1" 200
INFO     2026-02-11 22:21:29,671 uvicorn.access:480 server: ::1:50852 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:29,675 uvicorn.access:480 server: ::1:50852 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:29,872 uvicorn.access:480 server: ::1:50852 - "POST
         /v1/vector_stores/vs_0972d5db-6f6c-4123-ba83-fcef875fb548/files HTTP/1.1" 200
INFO     2026-02-11 22:21:29,882 uvicorn.access:480 server: ::1:50852 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:29,886 uvicorn.access:480 server: ::1:50852 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:30,087 uvicorn.access:480 server: ::1:50852 - "POST
         /v1/vector_stores/vs_0972d5db-6f6c-4123-ba83-fcef875fb548/files HTTP/1.1" 200
INFO     2026-02-11 22:21:30,092 uvicorn.access:480 server: ::1:50852 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:30,096 uvicorn.access:480 server: ::1:50852 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:30,285 uvicorn.access:480 server: ::1:50852 - "POST
         /v1/vector_stores/vs_0972d5db-6f6c-4123-ba83-fcef875fb548/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 56737f2716ae5ad08e64c39a2eb941823f6602a1356ff54141e01e508ececf99
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:30,411 uvicorn.access:480 server: ::1:50852 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:30,412 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         56737f2716ae5ad08e64c39a2eb941823f6602a1356ff54141e01e508ececf99
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:31,444 uvicorn.access:480 server: ::1:50860 - "DELETE
         /v1/vector_stores/vs_0972d5db-6f6c-4123-ba83-fcef875fb548 HTTP/1.1" 200
INFO     2026-02-11 22:21:31,450 uvicorn.access:480 server: ::1:50860 - "DELETE /v1/files/file-630021438843 HTTP/1.1"
         200
INFO     2026-02-11 22:21:31,454 uvicorn.access:480 server: ::1:50860 - "DELETE /v1/files/file-630021438844 HTTP/1.1"
         200
INFO     2026-02-11 22:21:31,459 uvicorn.access:480 server: ::1:50860 - "DELETE /v1/files/file-630021438845 HTTP/1.1"
         200
INFO     2026-02-11 22:21:31,463 uvicorn.access:480 server: ::1:50860 - "DELETE /v1/files/file-630021438846 HTTP/1.1"
         200
INFO     2026-02-11 22:21:31,466 uvicorn.access:480 server: ::1:50860 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:31,620 uvicorn.access:480 server: ::1:50860 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:31,625 uvicorn.access:480 server: ::1:50860 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:31,629 uvicorn.access:480 server: ::1:50860 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:31,828 uvicorn.access:480 server: ::1:50860 - "POST
         /v1/vector_stores/vs_c9e5d61b-4dc2-4034-98f3-79f077ca06d7/files HTTP/1.1" 200
INFO     2026-02-11 22:21:31,833 uvicorn.access:480 server: ::1:50860 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:31,836 uvicorn.access:480 server: ::1:50860 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:32,072 uvicorn.access:480 server: ::1:50860 - "POST
         /v1/vector_stores/vs_c9e5d61b-4dc2-4034-98f3-79f077ca06d7/files HTTP/1.1" 200
INFO     2026-02-11 22:21:32,077 uvicorn.access:480 server: ::1:50860 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:32,082 uvicorn.access:480 server: ::1:50860 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:32,272 uvicorn.access:480 server: ::1:50860 - "POST
         /v1/vector_stores/vs_c9e5d61b-4dc2-4034-98f3-79f077ca06d7/files HTTP/1.1" 200
INFO     2026-02-11 22:21:32,278 uvicorn.access:480 server: ::1:50860 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:32,285 uvicorn.access:480 server: ::1:50860 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:32,476 uvicorn.access:480 server: ::1:50860 - "POST
         /v1/vector_stores/vs_c9e5d61b-4dc2-4034-98f3-79f077ca06d7/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: cd5699866810dff808e88b02d8ccac799c526b954a379d075690945c1d4947aa
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:32,567 uvicorn.access:480 server: ::1:50860 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:32,567 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         cd5699866810dff808e88b02d8ccac799c526b954a379d075690945c1d4947aa
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:33,592 uvicorn.access:480 server: ::1:47490 - "DELETE
         /v1/vector_stores/vs_c9e5d61b-4dc2-4034-98f3-79f077ca06d7 HTTP/1.1" 200
INFO     2026-02-11 22:21:33,598 uvicorn.access:480 server: ::1:47490 - "DELETE /v1/files/file-664068282482 HTTP/1.1"
         200
INFO     2026-02-11 22:21:33,603 uvicorn.access:480 server: ::1:47490 - "DELETE /v1/files/file-664068282483 HTTP/1.1"
         200
INFO     2026-02-11 22:21:33,607 uvicorn.access:480 server: ::1:47490 - "DELETE /v1/files/file-664068282484 HTTP/1.1"
         200
INFO     2026-02-11 22:21:33,612 uvicorn.access:480 server: ::1:47490 - "DELETE /v1/files/file-664068282485 HTTP/1.1"
         200
INFO     2026-02-11 22:21:33,615 uvicorn.access:480 server: ::1:47490 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:33,755 uvicorn.access:480 server: ::1:47490 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:33,760 uvicorn.access:480 server: ::1:47490 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:33,765 uvicorn.access:480 server: ::1:47490 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,215 uvicorn.access:480 server: ::1:47490 - "POST
         /v1/vector_stores/vs_6e5ac52c-71aa-4d97-bc77-cf606734b611/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,220 uvicorn.access:480 server: ::1:47490 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,224 uvicorn.access:480 server: ::1:47490 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,426 uvicorn.access:480 server: ::1:47490 - "POST
         /v1/vector_stores/vs_6e5ac52c-71aa-4d97-bc77-cf606734b611/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,431 uvicorn.access:480 server: ::1:47490 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,435 uvicorn.access:480 server: ::1:47490 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,641 uvicorn.access:480 server: ::1:47490 - "POST
         /v1/vector_stores/vs_6e5ac52c-71aa-4d97-bc77-cf606734b611/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,647 uvicorn.access:480 server: ::1:47490 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,651 uvicorn.access:480 server: ::1:47490 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:34,854 uvicorn.access:480 server: ::1:47490 - "POST
         /v1/vector_stores/vs_6e5ac52c-71aa-4d97-bc77-cf606734b611/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: db08d6a776a8f3fbd7a8a0e2c7f028ff62c381cf1ace2d9f7396f67901131095
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:34,980 uvicorn.access:480 server: ::1:47490 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:34,981 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         db08d6a776a8f3fbd7a8a0e2c7f028ff62c381cf1ace2d9f7396f67901131095
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:35,907 uvicorn.access:480 server: ::1:47506 - "DELETE
         /v1/vector_stores/vs_6e5ac52c-71aa-4d97-bc77-cf606734b611 HTTP/1.1" 200
INFO     2026-02-11 22:21:35,913 uvicorn.access:480 server: ::1:47506 - "DELETE /v1/files/file-710505118846 HTTP/1.1"
         200
INFO     2026-02-11 22:21:35,918 uvicorn.access:480 server: ::1:47506 - "DELETE /v1/files/file-710505118847 HTTP/1.1"
         200
INFO     2026-02-11 22:21:35,922 uvicorn.access:480 server: ::1:47506 - "DELETE /v1/files/file-710505118848 HTTP/1.1"
         200
INFO     2026-02-11 22:21:35,927 uvicorn.access:480 server: ::1:47506 - "DELETE /v1/files/file-710505118849 HTTP/1.1"
         200
INFO     2026-02-11 22:21:35,930 uvicorn.access:480 server: ::1:47506 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:36,069 uvicorn.access:480 server: ::1:47506 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:36,075 uvicorn.access:480 server: ::1:47506 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,080 uvicorn.access:480 server: ::1:47506 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,302 uvicorn.access:480 server: ::1:47506 - "POST
         /v1/vector_stores/vs_ea1c25ee-167d-43cb-835e-3555e046c607/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,307 uvicorn.access:480 server: ::1:47506 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,311 uvicorn.access:480 server: ::1:47506 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,552 uvicorn.access:480 server: ::1:47506 - "POST
         /v1/vector_stores/vs_ea1c25ee-167d-43cb-835e-3555e046c607/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,557 uvicorn.access:480 server: ::1:47506 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,561 uvicorn.access:480 server: ::1:47506 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,772 uvicorn.access:480 server: ::1:47506 - "POST
         /v1/vector_stores/vs_ea1c25ee-167d-43cb-835e-3555e046c607/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,777 uvicorn.access:480 server: ::1:47506 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,781 uvicorn.access:480 server: ::1:47506 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:36,981 uvicorn.access:480 server: ::1:47506 - "POST
         /v1/vector_stores/vs_ea1c25ee-167d-43cb-835e-3555e046c607/files HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 6013eac3b956e915453ccf1d624a234ede435f32b48c732a5525c4b0cb65e687
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:37,133 uvicorn.access:480 server: ::1:47506 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:37,134 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         6013eac3b956e915453ccf1d624a234ede435f32b48c732a5525c4b0cb65e687
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:38,147 uvicorn.access:480 server: ::1:47512 - "DELETE
         /v1/vector_stores/vs_ea1c25ee-167d-43cb-835e-3555e046c607 HTTP/1.1" 200
INFO     2026-02-11 22:21:38,162 uvicorn.access:480 server: ::1:47512 - "DELETE /v1/files/file-66545595855 HTTP/1.1" 200
INFO     2026-02-11 22:21:38,173 uvicorn.access:480 server: ::1:47512 - "DELETE /v1/files/file-66545595856 HTTP/1.1" 200
INFO     2026-02-11 22:21:38,185 uvicorn.access:480 server: ::1:47512 - "DELETE /v1/files/file-66545595857 HTTP/1.1" 200
INFO     2026-02-11 22:21:38,201 uvicorn.access:480 server: ::1:47512 - "DELETE /v1/files/file-66545595858 HTTP/1.1" 200
INFO     2026-02-11 22:21:38,204 uvicorn.access:480 server: ::1:47512 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:38,351 uvicorn.access:480 server: ::1:47512 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:38,357 uvicorn.access:480 server: ::1:47512 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:38,364 uvicorn.access:480 server: ::1:47512 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:38,586 uvicorn.access:480 server: ::1:47512 - "POST
         /v1/vector_stores/vs_3d0b2665-0224-4622-a8e5-335928a11ed2/files HTTP/1.1" 200
INFO     2026-02-11 22:21:38,593 uvicorn.access:480 server: ::1:47512 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:38,605 uvicorn.access:480 server: ::1:47512 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:38,821 uvicorn.access:480 server: ::1:47512 - "POST
         /v1/vector_stores/vs_3d0b2665-0224-4622-a8e5-335928a11ed2/files HTTP/1.1" 200
INFO     2026-02-11 22:21:38,826 uvicorn.access:480 server: ::1:47512 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:38,831 uvicorn.access:480 server: ::1:47512 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:39,037 uvicorn.access:480 server: ::1:47512 - "POST
         /v1/vector_stores/vs_3d0b2665-0224-4622-a8e5-335928a11ed2/files HTTP/1.1" 200
INFO     2026-02-11 22:21:39,042 uvicorn.access:480 server: ::1:47512 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:39,046 uvicorn.access:480 server: ::1:47512 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:39,309 uvicorn.access:480 server: ::1:47512 - "POST
         /v1/vector_stores/vs_3d0b2665-0224-4622-a8e5-335928a11ed2/files HTTP/1.1" 200
INFO     2026-02-11 22:21:39,313 uvicorn.access:480 server: ::1:47512 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:39,515 uvicorn.access:480 server: ::1:47512 - "DELETE
         /v1/vector_stores/vs_3d0b2665-0224-4622-a8e5-335928a11ed2 HTTP/1.1" 200
INFO     2026-02-11 22:21:39,521 uvicorn.access:480 server: ::1:47512 - "DELETE /v1/files/file-450428750202 HTTP/1.1"
         200
INFO     2026-02-11 22:21:39,526 uvicorn.access:480 server: ::1:47512 - "DELETE /v1/files/file-450428750203 HTTP/1.1"
         200
INFO     2026-02-11 22:21:39,535 uvicorn.access:480 server: ::1:47512 - "DELETE /v1/files/file-450428750204 HTTP/1.1"
         200
INFO     2026-02-11 22:21:39,541 uvicorn.access:480 server: ::1:47512 - "DELETE /v1/files/file-450428750205 HTTP/1.1"
         200
INFO     2026-02-11 22:21:39,547 uvicorn.access:480 server: ::1:47528 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:39,676 uvicorn.access:480 server: ::1:47528 - "DELETE
         /v1/vector_stores/vs_24c30eba-ac3c-4ae5-b70b-7568606898fa HTTP/1.1" 200
INFO     2026-02-11 22:21:39,819 uvicorn.access:480 server: ::1:47528 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:39,824 uvicorn.access:480 server: ::1:47528 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:39,828 uvicorn.access:480 server: ::1:47528 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:40,493 uvicorn.access:480 server: ::1:47528 - "POST
         /v1/vector_stores/vs_755986a5-e19f-4e69-a666-0cf24a54094b/files HTTP/1.1" 200
INFO     2026-02-11 22:21:40,497 uvicorn.access:480 server: ::1:47528 - "GET
         /v1/vector_stores/vs_755986a5-e19f-4e69-a666-0cf24a54094b/files/file-379221123213 HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 308dc73ac6f24a41129c10634710e6bb80b350fce0fb614cbc1b3c5a985b62d0
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:40,587 uvicorn.access:480 server: ::1:47528 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:40,588 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         308dc73ac6f24a41129c10634710e6bb80b350fce0fb614cbc1b3c5a985b62d0
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:41,014 uvicorn.access:480 server: ::1:47512 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:41,134 uvicorn.access:480 server: ::1:47512 - "DELETE
         /v1/vector_stores/vs_755986a5-e19f-4e69-a666-0cf24a54094b HTTP/1.1" 200
INFO     2026-02-11 22:21:41,275 uvicorn.access:480 server: ::1:47512 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:41,550 uvicorn.access:480 server: ::1:47512 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:41,554 uvicorn.access:480 server: ::1:47512 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:41,648 uvicorn.access:480 server: ::1:47512 - "DELETE
         /v1/vector_stores/vs_e953a97b-de0c-4d9b-96ed-2940c336ad6b HTTP/1.1" 200
INFO     2026-02-11 22:21:41,787 uvicorn.access:480 server: ::1:47512 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:41,792 uvicorn.access:480 server: ::1:47512 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:41,798 uvicorn.access:480 server: ::1:47512 - "DELETE /v1/files/file-528246887823 HTTP/1.1"
         200
INFO     2026-02-11 22:21:41,802 uvicorn.access:480 server: ::1:47512 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:41,996 uvicorn.access:480 server: ::1:47512 - "POST
         /v1/vector_stores/vs_cb291f5e-6265-4bd2-9822-b4275bd046ee/files HTTP/1.1" 200
INFO     2026-02-11 22:21:42,000 uvicorn.access:480 server: ::1:47512 - "GET
         /v1/vector_stores/vs_cb291f5e-6265-4bd2-9822-b4275bd046ee/files/file-797509666839 HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: d00bbc6a7ad1768fb0baa366a67330d45fa7cd6aeac93d1563e8cbb5bc868109
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:42,119 uvicorn.access:480 server: ::1:47512 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:21:42,120 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         d00bbc6a7ad1768fb0baa366a67330d45fa7cd6aeac93d1563e8cbb5bc868109
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:21:43,328 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:43,940 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 400
INFO     2026-02-11 22:21:44,619 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:45,167 uvicorn.access:480 server: ::1:44628 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:45,329 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
ERROR    2026-02-11 22:21:45,953 llama_stack.providers.inline.agents.meta_reference.responses.streaming:1309
         agents::meta_reference: Failed to list MCP tools from http://localhost:54603/sse: Client error '401
         Unauthorized' for url 'http://localhost:54603/sse'
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/mcp/client/sse.py:74 in sse_client                                  │
         │                                                                                                             │
         │    71 │   │   │   │   │   "GET",                                                                            │
         │    72 │   │   │   │   │   url,                                                                              │
         │    73 │   │   │   │   ) as event_source:                                                                    │
         │ ❱  74 │   │   │   │   │   event_source.response.raise_for_status()                                          │
         │    75 │   │   │   │   │   logger.debug("SSE connection established")                                        │
         │    76 │   │   │   │   │                                                                                     │
         │    77 │   │   │   │   │   async def sse_reader(                                                             │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/httpx/_models.py:829 in raise_for_status                            │
         │                                                                                                             │
         │    826 │   │   }                                                                                            │
         │    827 │   │   error_type = error_types.get(status_class, "Invalid status code")                            │
         │    828 │   │   message = message.format(self, error_type=error_type)                                        │
         │ ❱  829 │   │   raise HTTPStatusError(message, request=request, response=self)                               │
         │    830 │                                                                                                    │
         │    831 │   def json(self, **kwargs: typing.Any) -> typing.Any:                                              │
         │    832 │   │   return jsonlib.loads(self.content, **kwargs)                                                 │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         HTTPStatusError: Client error '401 Unauthorized' for url 'http://localhost:54603/sse'
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

         The above exception was the direct cause of the following exception:

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py:1256 in            │
         │ _process_mcp_tool                                                                                           │
         │                                                                                                             │
         │   1253 │   │   │   # TODO: follow semantic conventions for Open Telemetry tool spans                        │
         │   1254 │   │   │   #                                                                                        │
         │        https://opentelemetry.io/docs/specs/semconv/gen-ai/gen-ai-spans/#execute-tool-span                   │
         │   1255 │   │   │   with tracer.start_as_current_span("list_mcp_tools", attributes=attributes):              │
         │ ❱ 1256 │   │   │   │   tool_defs = await list_mcp_tools(                                                    │
         │   1257 │   │   │   │   │   endpoint=mcp_tool.server_url,                                                    │
         │   1258 │   │   │   │   │   headers=mcp_tool.headers,                                                        │
         │   1259 │   │   │   │   │   authorization=mcp_tool.authorization,                                            │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:404 in list_mcp_tools                               │
         │                                                                                                             │
         │   401 │                                                                                                     │
         │   402 │   # If a session manager is provided, use it for session reuse (fix for #4452)                      │
         │   403 │   if session_manager is not None:                                                                   │
         │ ❱ 404 │   │   session = await session_manager.get_session(endpoint, final_headers)                          │
         │   405 │   │   await _list_tools_from_session(session)                                                       │
         │   406 │   else:                                                                                             │
         │   407 │   │   # Fallback to original behavior: create a new session for this call                           │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:144 in get_session                                  │
         │                                                                                                             │
         │   141 │   │   │   │   return session                                                                        │
         │   142 │   │   │                                                                                             │
         │   143 │   │   │   # Create new session                                                                      │
         │ ❱ 144 │   │   │   session, client_ctx, session_ctx = await self._create_session(endpoint,                   │
         │       headers)                                                                                              │
         │   145 │   │   │   self._sessions[key] = (session, client_ctx, session_ctx)                                  │
         │   146 │   │   │   logger.debug(f"Created new MCP session for {endpoint} (key: {key[:32]}...)")              │
         │   147 │   │   │   return session                                                                            │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/utils/tools/mcp.py:194 in _create_session                              │
         │                                                                                                             │
         │   191 │   │   │   │   for exc in eg.exceptions:                                                             │
         │   192 │   │   │   │   │   err = cast(httpx.HTTPStatusError, exc)                                            │
         │   193 │   │   │   │   │   if err.response.status_code == 401:                                               │
         │ ❱ 194 │   │   │   │   │   │   raise AuthenticationRequiredError(exc) from exc                               │
         │   195 │   │   │   │   if i == len(connection_strategies) - 1:                                               │
         │   196 │   │   │   │   │   raise                                                                             │
         │   197 │   │   │   │   last_exception = eg                                                                   │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         AuthenticationRequiredError: Client error '401 Unauthorized' for url 'http://localhost:54603/sse'
         For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/mcp/client/sse.py", line 74, in sse_client
    event_source.response.raise_for_status()
  File "/usr/local/lib/python3.12/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'http://localhost:54603/sse'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 542, in create_openai_response
    async for stream_chunk in stream_gen:
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 667, in _create_streaming_response
    async for stream_chunk in orchestrator.create_response():
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 282, in create_response
    async for stream_event in self._process_tools(output_messages):
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1323, in _process_tools
    async for stream_event in self._process_new_tools(
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1213, in _process_new_tools
    async for stream_event in self._process_mcp_tool(input_tool, output_messages):
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/streaming.py", line 1256, in _process_mcp_tool
    tool_defs = await list_mcp_tools(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 404, in list_mcp_tools
    session = await session_manager.get_session(endpoint, final_headers)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 144, in get_session
    session, client_ctx, session_ctx = await self._create_session(endpoint, headers)
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/utils/tools/mcp.py", line 194, in _create_session
    raise AuthenticationRequiredError(exc) from exc
llama_stack.core.datatypes.AuthenticationRequiredError: Client error '401 Unauthorized' for url 'http://localhost:54603/sse'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
INFO     2026-02-11 22:21:46,116 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 401
INFO     2026-02-11 22:21:46,230 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:46,924 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:46,969 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:47,611 llama_stack.providers.inline.agents.meta_reference.responses.streaming:520
         agents::meta_reference: Requesting approval for call_giaayybgGw4kjFpGbbfesoBN on get_boiling_point
INFO     2026-02-11 22:21:47,622 uvicorn.access:480 server: ::1:44628 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:47,636 llama_stack.providers.inline.agents.meta_reference.responses.streaming:517
         agents::meta_reference: Approval denied for call_giaayybgGw4kjFpGbbfesoBN on get_boiling_point
INFO     2026-02-11 22:21:47,646 uvicorn.access:480 server: ::1:44628 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:48,165 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:48,169 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:48,202 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:48,231 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:48,262 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:48,301 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:48,304 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:48,325 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:48,510 uvicorn.access:480 server: ::1:44628 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:49,121 uvicorn.access:480 server: ::1:44628 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:49,812 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:50,078 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 468, in app
    raise validation_error
fastapi.exceptions.RequestValidationError: 1 validation error:
  {'type': 'greater_than_equal', 'loc': ('body', 'max_tool_calls'), 'msg': 'Input should be greater than or equal to 1', 'input': 0, 'ctx': {'ge': 1}}

  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 192, in create_openai_response
    POST /v1/responses
INFO     2026-02-11 22:21:50,083 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 400
INFO     2026-02-11 22:21:50,871 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:50,983 llama_stack.providers.inline.agents.meta_reference.responses.streaming:1056
         agents::meta_reference: Ignoring built-in and mcp tool call since reached the limit of self.max_tool_calls=1.
INFO     2026-02-11 22:21:51,023 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:51,666 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:52,396 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:52,515 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:52,626 llama_stack.providers.inline.agents.meta_reference.responses.streaming:443
         agents::meta_reference: Exiting inference loop since there is a function (client-side) tool call
INFO     2026-02-11 22:21:52,733 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:53,426 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:54,056 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:54,797 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:54,986 uvicorn.access:480 server: ::1:44614 - "GET
         /v1/responses/resp_e7f7dbda-90cd-4f99-9bdc-2c0624c5a96d HTTP/1.1" 200
INFO     2026-02-11 22:21:55,286 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:55,291 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:55,600 uvicorn.access:480 server: ::1:44614 - "GET
         /v1/responses/resp_dc10af41-ae66-475c-a1f7-0637eeb072e9 HTTP/1.1" 200
INFO     2026-02-11 22:21:55,604 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:56,168 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:56,553 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:21:56,558 uvicorn.access:480 server: ::1:44614 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:57,135 uvicorn.access:480 server: ::1:44614 - "DELETE
         /v1/vector_stores/vs_cb291f5e-6265-4bd2-9822-b4275bd046ee HTTP/1.1" 200
INFO     2026-02-11 22:21:57,814 uvicorn.access:480 server: ::1:44614 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:21:57,927 uvicorn.access:480 server: ::1:44614 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:21:57,985 uvicorn.access:480 server: ::1:44614 - "DELETE /v1/files/file-861837565219 HTTP/1.1"
         200
INFO     2026-02-11 22:21:58,217 uvicorn.access:480 server: ::1:44614 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:22:05,506 uvicorn.access:480 server: ::1:44614 - "POST
         /v1/vector_stores/vs_3b5a3364-d763-460e-ae70-2c1f346e4a3a/files HTTP/1.1" 200
INFO     2026-02-11 22:22:05,655 uvicorn.access:480 server: ::1:44614 - "GET
         /v1/vector_stores/vs_3b5a3364-d763-460e-ae70-2c1f346e4a3a/files/file-864460993305 HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 0caed0fc68925ad15a1464ff71041d91e3db067c94e54d2b18ad4215556d4172
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:22:09,024 uvicorn.access:480 server: ::1:44614 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:22:09,026 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         0caed0fc68925ad15a1464ff71041d91e3db067c94e54d2b18ad4215556d4172
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:22:10,201 llama_stack.providers.inline.agents.meta_reference.responses.streaming:520
         agents::meta_reference: Requesting approval for call_Eps4RVKUQK4eJUXk4BST41as on get_boiling_point
INFO     2026-02-11 22:22:10,475 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:10,600 llama_stack.providers.inline.agents.meta_reference.responses.streaming:514
         agents::meta_reference: Approval granted for call_Eps4RVKUQK4eJUXk4BST41as on get_boiling_point
INFO     2026-02-11 22:22:10,722 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:11,856 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:12,468 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:13,948 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:14,149 uvicorn.access:480 server: ::1:45892 - "GET
         /v1/responses/resp_b4febeeb-a969-4eb1-af58-8da8b1627918 HTTP/1.1" 200
INFO     2026-02-11 22:22:14,728 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:14,732 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:15,247 uvicorn.access:480 server: ::1:45892 - "GET
         /v1/responses/resp_afbcb033-ea35-40d7-8a20-56c1fe1b1e93 HTTP/1.1" 200
INFO     2026-02-11 22:22:15,250 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:16,177 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:16,354 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:16,359 uvicorn.access:480 server: ::1:45892 - "GET /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:22:17,182 uvicorn.access:480 server: ::1:45892 - "DELETE
         /v1/vector_stores/vs_3b5a3364-d763-460e-ae70-2c1f346e4a3a HTTP/1.1" 200
INFO     2026-02-11 22:22:18,417 uvicorn.access:480 server: ::1:45892 - "POST /v1/vector_stores HTTP/1.1" 200
INFO     2026-02-11 22:22:18,875 uvicorn.access:480 server: ::1:45892 - "GET /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:22:19,381 uvicorn.access:480 server: ::1:45892 - "DELETE /v1/files/file-379221123213 HTTP/1.1"
         200
INFO     2026-02-11 22:22:19,695 uvicorn.access:480 server: ::1:45892 - "POST /v1/files HTTP/1.1" 200
INFO     2026-02-11 22:22:35,082 uvicorn.access:480 server: ::1:45892 - "POST
         /v1/vector_stores/vs_fc3f3d7e-d44d-443f-95cf-d9e8effeb3e8/files HTTP/1.1" 200
INFO     2026-02-11 22:22:35,144 uvicorn.access:480 server: ::1:45892 - "GET
         /v1/vector_stores/vs_fc3f3d7e-d44d-443f-95cf-d9e8effeb3e8/files/file-156847829497 HTTP/1.1" 200
Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py", line 307, in __call__
    await self.app(scope, receive, send)
  File "/workspace/src/llama_stack/core/server/server.py", line 374, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/core/server/server.py", line 343, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/fastapi/routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack_api/agents/fastapi_routes.py", line 212, in create_openai_response
    result = await impl.create_openai_response(request)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py", line 110, in create_openai_response
    result = await self.openai_responses_impl.create_openai_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py", line 563, in create_openai_response
    raise RuntimeError(f"OpenAI response failed: {error_message}")
RuntimeError: OpenAI response failed: Recording not found for request hash: 370511eee131d6150b1f5cbab9e9821869131bc8d52b82b007584e8d88ba6bfa
Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:22:46,920 uvicorn.access:480 server: ::1:45892 - "POST /v1/responses HTTP/1.1" 500
ERROR    2026-02-11 22:22:46,921 uvicorn.error:415 server: Exception in ASGI application

         ╭───────────────────────────────────── Traceback (most recent call last) ─────────────────────────────────────╮
         │ /usr/local/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py:410 in run_asgi                  │
         │                                                                                                             │
         │   407 │   # ASGI exception wrapper                                                                          │
         │   408 │   async def run_asgi(self, app: ASGI3Application) -> None:                                          │
         │   409 │   │   try:                                                                                          │
         │ ❱ 410 │   │   │   result = await app(  # type: ignore[func-returns-value]                                   │
         │   411 │   │   │   │   self.scope, self.receive, self.send                                                   │
         │   412 │   │   │   )                                                                                         │
         │   413 │   │   except BaseException as exc:                                                                  │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py:60 in __call__                  │
         │                                                                                                             │
         │    57 │   │   │   │   │   port = 0                                                                          │
         │    58 │   │   │   │   │   scope["client"] = (host, port)                                                    │
         │    59 │   │                                                                                                 │
         │ ❱  60 │   │   return await self.app(scope, receive, send)                                                   │
         │    61                                                                                                       │
         │    62                                                                                                       │
         │    63 def _parse_raw_hosts(value: str) -> list[str]:                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/applications.py:1138 in __call__                            │
         │                                                                                                             │
         │   1135 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                    │
         │   1136 │   │   if self.root_path:                                                                           │
         │   1137 │   │   │   scope["root_path"] = self.root_path                                                      │
         │ ❱ 1138 │   │   await super().__call__(scope, receive, send)                                                 │
         │   1139 │                                                                                                    │
         │   1140 │   def add_api_route(                                                                               │
         │   1141 │   │   self,                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/applications.py:107 in __call__                           │
         │                                                                                                             │
         │   104 │   │   scope["app"] = self                                                                           │
         │   105 │   │   if self.middleware_stack is None:                                                             │
         │   106 │   │   │   self.middleware_stack = self.build_middleware_stack()                                     │
         │ ❱ 107 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   108 │                                                                                                     │
         │   109 │   def on_event(self, event_type: str) -> Callable:  # type: ignore[type-arg]                        │
         │   110 │   │   return self.router.on_event(event_type)  # pragma: no cover                                   │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/asgi/__init__.py:810 in __call__      │
         │                                                                                                             │
         │    807 │   │   │   │   │   attributes,                                                                      │
         │    808 │   │   │   │   )                                                                                    │
         │    809 │   │   │   │                                                                                        │
         │ ❱  810 │   │   │   │   await self.app(scope, otel_receive, otel_send)                                       │
         │    811 │   │   finally:                                                                                     │
         │    812 │   │   │   if scope["type"] == "http":                                                              │
         │    813 │   │   │   │   target = _collect_target_attribute(scope)                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:186 in __call__                      │
         │                                                                                                             │
         │   183 │   │   │   # We always continue to raise the exception.                                              │
         │   184 │   │   │   # This allows servers to log the error, or allows test clients                            │
         │   185 │   │   │   # to optionally raise the error within the test case.                                     │
         │ ❱ 186 │   │   │   raise exc                                                                                 │
         │   187 │                                                                                                     │
         │   188 │   def format_line(self, index: int, line: str, frame_lineno: int, frame_index: int) ->              │
         │       str:                                                                                                  │
         │   189 │   │   values = {                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/errors.py:164 in __call__                      │
         │                                                                                                             │
         │   161 │   │   │   await send(message)                                                                       │
         │   162 │   │                                                                                                 │
         │   163 │   │   try:                                                                                          │
         │ ❱ 164 │   │   │   await self.app(scope, receive, _send)                                                     │
         │   165 │   │   except Exception as exc:                                                                      │
         │   166 │   │   │   request = Request(scope)                                                                  │
         │   167 │   │   │   if self.debug:                                                                            │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/opentelemetry/instrumentation/fastapi/__init__.py:307 in __call__   │
         │                                                                                                             │
         │   304 │   │   │   │   │   │   self, scope: Scope, receive: Receive, send: Send                              │
         │   305 │   │   │   │   │   ) -> None:                                                                        │
         │   306 │   │   │   │   │   │   try:                                                                          │
         │ ❱ 307 │   │   │   │   │   │   │   await self.app(scope, receive, send)                                      │
         │   308 │   │   │   │   │   │   except Exception as exc:  # pylint:                                           │
         │       disable=broad-exception-caught                                                                        │
         │   309 │   │   │   │   │   │   │   span = get_current_span()                                                 │
         │   310 │   │   │   │   │   │   │   if span.is_recording():                                                   │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:374 in __call__                                            │
         │                                                                                                             │
         │   371 │   │   │   │   │   test_context_token = sync_test_context_from_provider_data()                       │
         │   372 │   │   │   │   │   reset_fn = reset_test_context                                                     │
         │   373 │   │   │   │   try:                                                                                  │
         │ ❱ 374 │   │   │   │   │   return await self.app(scope, receive, send)                                       │
         │   375 │   │   │   │   finally:                                                                              │
         │   376 │   │   │   │   │   if test_context_token and reset_fn:                                               │
         │   377 │   │   │   │   │   │   reset_fn(test_context_token)                                                  │
         │                                                                                                             │
         │ /workspace/src/llama_stack/core/server/server.py:343 in __call__                                            │
         │                                                                                                             │
         │   340 │   │   │   │   │   # If version parsing fails, let the request through                               │
         │   341 │   │   │   │   │   pass                                                                              │
         │   342 │   │                                                                                                 │
         │ ❱ 343 │   │   return await self.app(scope, receive, send)                                                   │
         │   344                                                                                                       │
         │   345                                                                                                       │
         │   346 class ProviderDataMiddleware:                                                                         │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63 in __call__                   │
         │                                                                                                             │
         │   60 │   │   else:                                                                                          │
         │   61 │   │   │   conn = WebSocket(scope, receive, send)                                                     │
         │   62 │   │                                                                                                  │
         │ ❱ 63 │   │   await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)                       │
         │   64 │                                                                                                      │
         │   65 │   async def http_exception(self, request: Request, exc: Exception) -> Response:                      │
         │   66 │   │   assert isinstance(exc, HTTPException)                                                          │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18 in __call__                 │
         │                                                                                                             │
         │   15 │   async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:                      │
         │   16 │   │   async with AsyncExitStack() as stack:                                                          │
         │   17 │   │   │   scope[self.context_name] = stack                                                           │
         │ ❱ 18 │   │   │   await self.app(scope, receive, send)                                                       │
         │   19                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:716 in __call__                                │
         │                                                                                                             │
         │   713 │   │   """                                                                                           │
         │   714 │   │   The main entry point to the Router class.                                                     │
         │   715 │   │   """                                                                                           │
         │ ❱ 716 │   │   await self.middleware_stack(scope, receive, send)                                             │
         │   717 │                                                                                                     │
         │   718 │   async def app(self, scope: Scope, receive: Receive, send: Send) -> None:                          │
         │   719 │   │   assert scope["type"] in ("http", "websocket", "lifespan")                                     │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:736 in app                                     │
         │                                                                                                             │
         │   733 │   │   │   match, child_scope = route.matches(scope)                                                 │
         │   734 │   │   │   if match == Match.FULL:                                                                   │
         │   735 │   │   │   │   scope.update(child_scope)                                                             │
         │ ❱ 736 │   │   │   │   await route.handle(scope, receive, send)                                              │
         │   737 │   │   │   │   return                                                                                │
         │   738 │   │   │   elif match == Match.PARTIAL and partial is None:                                          │
         │   739 │   │   │   │   partial = route                                                                       │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/routing.py:290 in handle                                  │
         │                                                                                                             │
         │   287 │   │   │   │   response = PlainTextResponse("Method Not Allowed", status_code=405,                   │
         │       headers=headers)                                                                                      │
         │   288 │   │   │   await response(scope, receive, send)                                                      │
         │   289 │   │   else:                                                                                         │
         │ ❱ 290 │   │   │   await self.app(scope, receive, send)                                                      │
         │   291 │                                                                                                     │
         │   292 │   def __eq__(self, other: Any) -> bool:                                                             │
         │   293 │   │   return (                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:121 in app                                       │
         │                                                                                                             │
         │    118 │   │   │   │   )                                                                                    │
         │    119 │   │                                                                                                │
         │    120 │   │   # Same as in Starlette                                                                       │
         │ ❱  121 │   │   await wrap_app_handling_exceptions(app, request)(scope, receive, send)                       │
         │    122 │                                                                                                    │
         │    123 │   return app                                                                                       │
         │    124                                                                                                      │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:53 in wrapped_app                   │
         │                                                                                                             │
         │   50 │   │   │   │   handler = _lookup_exception_handler(exception_handlers, exc)                           │
         │   51 │   │   │                                                                                              │
         │   52 │   │   │   if handler is None:                                                                        │
         │ ❱ 53 │   │   │   │   raise exc                                                                              │
         │   54 │   │   │                                                                                              │
         │   55 │   │   │   if response_started:                                                                       │
         │   56 │   │   │   │   raise RuntimeError("Caught handled exception, but response already                     │
         │      started.") from exc                                                                                    │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/starlette/_exception_handler.py:42 in wrapped_app                   │
         │                                                                                                             │
         │   39 │   │   │   await send(message)                                                                        │
         │   40 │   │                                                                                                  │
         │   41 │   │   try:                                                                                           │
         │ ❱ 42 │   │   │   await app(scope, receive, sender)                                                          │
         │   43 │   │   except Exception as exc:                                                                       │
         │   44 │   │   │   handler = None                                                                             │
         │   45                                                                                                        │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:107 in app                                       │
         │                                                                                                             │
         │    104 │   │   │   │   scope["fastapi_inner_astack"] = request_stack                                        │
         │    105 │   │   │   │   async with AsyncExitStack() as function_stack:                                       │
         │    106 │   │   │   │   │   scope["fastapi_function_astack"] = function_stack                                │
         │ ❱  107 │   │   │   │   │   response = await f(request)                                                      │
         │    108 │   │   │   │   await response(scope, receive, send)                                                 │
         │    109 │   │   │   │   # Continues customization                                                            │
         │    110 │   │   │   │   response_awaited = True                                                              │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:426 in app                                       │
         │                                                                                                             │
         │    423 │   │   )                                                                                            │
         │    424 │   │   errors = solved_result.errors                                                                │
         │    425 │   │   if not errors:                                                                               │
         │ ❱  426 │   │   │   raw_response = await run_endpoint_function(                                              │
         │    427 │   │   │   │   dependant=dependant,                                                                 │
         │    428 │   │   │   │   values=solved_result.values,                                                         │
         │    429 │   │   │   │   is_coroutine=is_coroutine,                                                           │
         │                                                                                                             │
         │ /usr/local/lib/python3.12/site-packages/fastapi/routing.py:314 in run_endpoint_function                     │
         │                                                                                                             │
         │    311 │   assert dependant.call is not None, "dependant.call must be a function"                           │
         │    312 │                                                                                                    │
         │    313 │   if is_coroutine:                                                                                 │
         │ ❱  314 │   │   return await dependant.call(**values)                                                        │
         │    315 │   else:                                                                                            │
         │    316 │   │   return await run_in_threadpool(dependant.call, **values)                                     │
         │    317                                                                                                      │
         │                                                                                                             │
         │ /workspace/src/llama_stack_api/agents/fastapi_routes.py:212 in create_openai_response                       │
         │                                                                                                             │
         │   209 │   │   request: Annotated[CreateResponseRequest, Body(...)],                                         │
         │   210 │   ) -> OpenAIResponseObject | StreamingResponse:                                                    │
         │   211 │   │   try:                                                                                          │
         │ ❱ 212 │   │   │   result = await impl.create_openai_response(request)                                       │
         │   213 │   │   except ValueError as exc:                                                                     │
         │   214 │   │   │   raise _http_exception_from_value_error(exc) from exc                                      │
         │   215                                                                                                       │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/agents.py:110 in create_openai_response   │
         │                                                                                                             │
         │   107 │   │   yielding response stream events (streaming).                                                  │
         │   108 │   │   """                                                                                           │
         │   109 │   │   assert self.openai_responses_impl is not None, "OpenAI responses not                          │
         │       initialized"                                                                                          │
         │ ❱ 110 │   │   result = await self.openai_responses_impl.create_openai_response(                             │
         │   111 │   │   │   input=request.input,                                                                      │
         │   112 │   │   │   model=request.model,                                                                      │
         │   113 │   │   │   prompt=request.prompt,                                                                    │
         │                                                                                                             │
         │ /workspace/src/llama_stack/providers/inline/agents/meta_reference/responses/openai_responses.py:563 in      │
         │ create_openai_response                                                                                      │
         │                                                                                                             │
         │   560 │   │   │   │   │   if failed_response and failed_response.error                                      │
         │   561 │   │   │   │   │   else "Response stream failed without error details"                               │
         │   562 │   │   │   │   )                                                                                     │
         │ ❱ 563 │   │   │   │   raise RuntimeError(f"OpenAI response failed: {error_message}")                        │
         │   564 │   │   │                                                                                             │
         │   565 │   │   │   if final_response is None:                                                                │
         │   566 │   │   │   │   raise ValueError("The response stream never reached a terminal state")                │
         ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
         RuntimeError: OpenAI response failed: Recording not found for request hash:
         370511eee131d6150b1f5cbab9e9821869131bc8d52b82b007584e8d88ba6bfa
         Model: gpt-4o | Request: POST https://api.openai.com/v1/v1/chat/completions

         Run './scripts/integration-tests.sh --inference-mode record-if-missing' with required API keys to generate.
INFO     2026-02-11 22:22:48,331 llama_stack.providers.inline.agents.meta_reference.responses.streaming:520
         agents::meta_reference: Requesting approval for call_upVpEp6APgdHdCjgOVigifl3 on get_boiling_point
INFO     2026-02-11 22:22:48,581 uvicorn.access:480 server: ::1:38162 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:49,284 llama_stack.providers.inline.agents.meta_reference.responses.streaming:517
         agents::meta_reference: Approval denied for call_upVpEp6APgdHdCjgOVigifl3 on get_boiling_point
INFO     2026-02-11 22:22:49,317 uvicorn.access:480 server: ::1:38162 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:50,954 uvicorn.access:480 server: ::1:38162 - "POST /v1/responses HTTP/1.1" 200
INFO     2026-02-11 22:22:51,566 uvicorn.access:480 server: ::1:38162 - "POST /v1/responses HTTP/1.1" 200
